<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>WebReference.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;JWebSwing&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">za.co.mmagon.jwebswing.generics</a> &gt; <span class="el_source">WebReference.java</span></div><h1>WebReference.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2017 Marc Magon
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package za.co.mmagon.jwebswing.generics;

import com.armineasy.injection.GuiceContext;
import com.fasterxml.jackson.annotation.JsonIgnore;
import com.fasterxml.jackson.annotation.JsonProperty;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.Comparator;
import java.util.logging.Logger;
import javax.servlet.http.HttpServletRequest;
import za.co.mmagon.jwebswing.base.html.interfaces.NamedPair;
import za.co.mmagon.jwebswing.base.servlets.enumarations.RequirementsPriority;
import za.co.mmagon.logger.LogFactory;

/**
 * Denotes a specific Web Reference, either remotely or locally
 *
 * @param &lt;T&gt; The type implementation
 *
 * @since Forever
 * @version 2.0
 * @author MMagon
 *
 * 2.0 Added Sorting
 */
public class WebReference&lt;T extends WebReference&gt; implements NamedPair&lt;String, String&gt;, Serializable, Comparator&lt;WebReference&gt;
{

    private static final long serialVersionUID = 1L;
    /**
     * The left side
     */
    @JsonIgnore
    private String left;
    /**
     * The right side
     */
    @JsonIgnore
    private String right;
    /**
     * If this must reference with the left side only
     */
<span class="fc" id="L59">    @JsonIgnore</span>
    private boolean leftOnly = true;
    /**
     * If the reference is local
     */
<span class="fc" id="L64">    private static boolean isLocal = true;</span>
    /**
     * The ridiculous sort order
     */
<span class="fc" id="L68">    @JsonIgnore</span>
<span class="fc" id="L69">    private Integer sortOrder = 500000;</span>
    /**
     * To use min at the end or not
     */
    @JsonIgnore
<span class="fc" id="L74">    private static boolean useMinAtEndOfExtension = false;</span>
    /**
     * The default priority
     */
<span class="fc" id="L78">    @JsonIgnore</span>
    private RequirementsPriority priority = RequirementsPriority.DontCare;
    /**
     * If the client can minify at the remote source
     */
<span class="fc" id="L83">    @JsonIgnore</span>
    private boolean canMinifyAtRemote = true;
    /**
     * If this reference is a cordova reference, e.g. does it render in the dynamic site loader
     */
<span class="fc" id="L88">    private boolean cordovaRequired = false;</span>
    /**
     * The name of the reference
     */
    private String name;
    /**
     * The specified version
     */
    private Double version;

    /**
     * The local reference
     */
    @JsonIgnore
    private String localReference;
    /**
     * The remote reference
     */
    @JsonIgnore
    private String remoteReference;

    /**
     * The dummy reference for the sorting
     */
<span class="fc" id="L112">    private static final WebReference dummyReference = new WebReference(null, null, null, null);</span>

    /**
     * Sets this JavaScript Reference with the Name, the Version
     *
     * @param name            The Name of the Plugin
     * @param version         The version of the Plugin
     * @param localReference  The local Reference
     * @param remoteReference The Remote Reference
     * @param sortOrder       The Sorting Order for the Reference
     */
    public WebReference(String name, Double version, String localReference, String remoteReference, int sortOrder)
<span class="fc" id="L124">    {</span>
<span class="fc" id="L125">        this.left = localReference;</span>
<span class="fc" id="L126">        this.right = remoteReference;</span>

<span class="fc" id="L128">        this.name = name;</span>
<span class="fc" id="L129">        this.version = version;</span>
<span class="fc" id="L130">        this.localReference = localReference;</span>
<span class="fc" id="L131">        this.remoteReference = remoteReference;</span>
<span class="fc" id="L132">    }</span>

    /**
     * Sets this JavaScript Reference with the Name, the Version
     *
     * @param name            The Name of the Plugin
     * @param version         The version of the Plugin
     * @param localReference  The local Reference
     * @param remoteReference The Remote Reference
     */
    public WebReference(String name, Double version, String localReference, String remoteReference)
    {
<span class="fc" id="L144">        this(name, version, localReference, remoteReference, 500000);</span>
<span class="fc" id="L145">    }</span>

    /**
     * Sets the local reference
     *
     * @param left
     *
     * @return
     */
    public T setLeft(String left)
    {
<span class="nc" id="L156">        this.left = left;</span>
<span class="nc" id="L157">        this.localReference = left;</span>
<span class="nc" id="L158">        return (T) this;</span>
    }

    /**
     * Sets the remote reference
     *
     * @param right
     *
     * @return
     */
    public T setRight(String right)
    {
<span class="nc" id="L170">        this.right = right;</span>
<span class="nc" id="L171">        this.remoteReference = right;</span>
<span class="nc" id="L172">        return (T) this;</span>
    }

    /**
     * Gets the local reference
     *
     * @return
     */
    @Override
    public String getLeft()
    {
<span class="nc" id="L183">        return localReference;</span>
    }

    /**
     * Sets the local reference
     *
     * @return
     */
    @Override
    public String getRight()
    {
<span class="nc" id="L194">        return remoteReference;</span>
    }

    @Override
    public int hashCode()
    {
<span class="nc" id="L200">        return left.hashCode() ^ right.hashCode();</span>
    }

    @Override
    public boolean equals(Object o)
    {
<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (o == null)</span>
        {
<span class="nc" id="L208">            return false;</span>
        }
<span class="nc bnc" id="L210" title="All 2 branches missed.">        if (!(o instanceof WebReference))</span>
        {
<span class="nc" id="L212">            return false;</span>
        }
<span class="nc" id="L214">        WebReference pairo = (WebReference) o;</span>
<span class="nc bnc" id="L215" title="All 4 branches missed.">        return this.left.equals(pairo.getLeft())</span>
                &amp;&amp; (!leftOnly
<span class="nc bnc" id="L217" title="All 2 branches missed.">                &amp;&amp; this.right.equals(pairo.getRight()));</span>
    }

    /**
     * Returns if this pair is set to validate on the left field only
     *
     * @return
     */
    public boolean isLeftOnly()
    {
<span class="nc" id="L227">        return leftOnly;</span>
    }

    /**
     * Sets if this pair should validate on the left pair only
     *
     * @param leftOnly
     *
     * @return
     */
    public T setLeftOnly(boolean leftOnly)
    {
<span class="nc" id="L239">        this.leftOnly = leftOnly;</span>
<span class="nc" id="L240">        return (T) this;</span>
    }

    /**
     * Whether or not to return the local reference or the remote reference
     *
     * @return
     */
    @JsonProperty(&quot;local&quot;)
    public static boolean isIsLocal()
    {
<span class="fc" id="L251">        return isLocal;</span>
    }

    /**
     * Sets whether this reference should be local or remote
     *
     * @param isLocal
     */
    public static void setIsLocal(boolean isLocal)
    {
<span class="fc" id="L261">        WebReference.isLocal = isLocal;</span>
<span class="fc" id="L262">    }</span>

    /**
     * Gets the name of this reference
     *
     * @return
     */
    public String getName()
    {
<span class="fc" id="L271">        return name;</span>
    }

    /**
     * Sets the name of this reference
     *
     * @param name
     *
     * @return
     */
    public T setName(String name)
    {
<span class="nc" id="L283">        this.name = name;</span>
<span class="nc" id="L284">        return (T) this;</span>
    }

    /**
     * Gets the double version of this reference
     *
     * @return
     */
    public Double getVersion()
    {
<span class="fc" id="L294">        return version;</span>
    }

    /**
     * Sets the double version of this reference
     *
     * @param version
     *
     * @return
     */
    public T setVersion(Double version)
    {
<span class="nc" id="L306">        this.version = version;</span>
<span class="nc" id="L307">        return (T) this;</span>
    }

    /**
     * Gets the physical local reference
     *
     * @return
     */
    public String getLocalReference()
    {
<span class="fc" id="L317">        return localReference;</span>
    }

    /**
     * Sets the physical local reference
     *
     * @param localReference
     *
     * @return
     */
    public T setLocalReference(String localReference)
    {
<span class="nc" id="L329">        setLeft(localReference);</span>
<span class="nc" id="L330">        this.localReference = localReference;</span>
<span class="nc" id="L331">        return (T) this;</span>
    }

    /**
     * Gets the physical remote reference
     *
     * @return
     */
    public String getRemoteReference()
    {
<span class="fc" id="L341">        return remoteReference;</span>
    }

    /**
     * Sets the remote physical reference
     *
     * @param remoteReference
     *
     * @return
     */
    public T setRemoteReference(String remoteReference)
    {
<span class="nc" id="L353">        setRight(remoteReference);</span>
<span class="nc" id="L354">        this.remoteReference = remoteReference;</span>
<span class="nc" id="L355">        return (T) this;</span>
    }

<span class="fc" id="L358">    private static final Logger LOG = LogFactory.getInstance().getLogger(&quot;Web Reference&quot;);</span>

    /**
     * Sets whether or not to use &quot;min.js&quot; or use a folder for the min directory
     *
     * @return
     */
    public static final boolean isUseMinAtEndOfExtension()
    {
<span class="nc" id="L367">        return useMinAtEndOfExtension;</span>
    }

    /**
     * Sets whether or not to append min into the filename
     *
     * @param useMinAtEndOfExtension
     */
    public static final void setUseMinAtEndOfExtension(boolean useMinAtEndOfExtension)
    {
<span class="nc" id="L377">        WebReference.useMinAtEndOfExtension = useMinAtEndOfExtension;</span>
<span class="nc" id="L378">    }</span>

    /**
     * Compares two references to each other on sort order
     *
     * @param o1
     * @param o2
     *
     * @return
     */
    @Override
    public int compare(WebReference o1, WebReference o2)
    {
<span class="fc" id="L391">        return o1.getSortOrder().compareTo(o2.getSortOrder());</span>
    }

    /**
     * Default Sort Order
     * &lt;p&gt;
     * 0 - Root (JQuery) 5 - Core 10 - Core Accompanied 15 - Stand Alone Components 20 - Complex Components 500k - Default 600k - Atmosphere Reserved
     *
     * @return
     */
    public Integer getSortOrder()
    {
<span class="fc" id="L403">        return sortOrder;</span>
    }

    /**
     * Default Sort Order
     * &lt;p&gt;
     * 0 - Root (JQuery) 5 - Core 10 - Core Accompanied 15 - Stand Alone Components 20 - Complex Components 500k - Default 600k - Atmosphere Reserved
     * &lt;p&gt;
     * @param sortOrder
     *
     * @return
     */
    public final T setSortOrder(Integer sortOrder)
    {
<span class="fc" id="L417">        this.sortOrder = sortOrder;</span>
<span class="fc" id="L418">        return (T) this;</span>
    }

    /**
     * Sorts an Array List of References
     *
     * @param arrayList
     *
     * @return
     */
    public static ArrayList&lt;? extends WebReference&gt; sort(ArrayList&lt;? extends WebReference&gt; arrayList)
    {
<span class="fc" id="L430">        arrayList.sort(dummyReference);</span>
<span class="fc" id="L431">        return arrayList;</span>
    }

    /**
     * Returns a dummy reference for the sorting array
     *
     * @return
     */
    public static WebReference getDummyReference()
    {
<span class="fc" id="L441">        return dummyReference;</span>
    }

    /**
     * Return the priority of the reference
     *
     * @return
     */
    public RequirementsPriority getPriority()
    {
<span class="fc" id="L451">        return priority;</span>
    }

    /**
     * Sets the priority of the reference
     *
     * @param priority
     *
     * @return
     */
    public T setPriority(RequirementsPriority priority)
    {
<span class="fc" id="L463">        this.priority = priority;</span>
<span class="fc" id="L464">        return (T) this;</span>
    }

    /**
     * Specifies if the remote has a min file
     *
     * @return
     */
    public boolean isCanMinifyAtRemote()
    {
<span class="nc" id="L474">        return canMinifyAtRemote;</span>
    }

    /**
     * Specifies if the remote has a min file
     *
     * @param canMinifyAtRemote
     *
     * @return
     */
    public T setCanMinifyAtRemote(boolean canMinifyAtRemote)
    {
<span class="nc" id="L486">        this.canMinifyAtRemote = canMinifyAtRemote;</span>
<span class="nc" id="L487">        return (T) this;</span>
    }

    /**
     * If this reference is a cordova reference, e.g. does it render in the dynamic site loader
     *
     * @return
     */
    public boolean isCordovaRequired()
    {
<span class="fc" id="L497">        return cordovaRequired;</span>
    }

    /**
     * If this reference is a cordova reference, e.g. does it render in the dynamic site loader
     *
     * @param cordovaRequired
     *
     * @return
     */
    public T setCordovaRequired(boolean cordovaRequired)
    {
<span class="fc" id="L509">        this.cordovaRequired = cordovaRequired;</span>
<span class="fc" id="L510">        return (T) this;</span>
    }

    /**
     * Returns either the local or remote reference depending on configuration
     * &lt;p&gt;
     * @return
     */
    @Override
    @JsonProperty(&quot;reference&quot;)
    public final String toString()
    {
<span class="fc bfc" id="L522" title="All 2 branches covered.">        if (isIsLocal())</span>
        {
<span class="fc" id="L524">            StringBuilder sb = new StringBuilder(getLocalReference());</span>
<span class="pc bpc" id="L525" title="1 of 2 branches missed.">            if (useMinAtEndOfExtension)</span>
            {
<span class="nc bnc" id="L527" title="All 2 branches missed.">                if (!sb.toString().contains(&quot;.min.&quot;))</span>
                {
<span class="nc" id="L529">                    sb.insert(sb.lastIndexOf(&quot;.&quot;), &quot;.min&quot;);</span>
                }
            }
<span class="pc bpc" id="L532" title="1 of 2 branches missed.">            if (sb.indexOf(&quot;http&quot;) &lt; 0)</span>
            {
                try
                {
<span class="fc bfc" id="L536" title="All 2 branches covered.">                    if (!GuiceContext.isBuildingInjector())</span>
                    {
<span class="nc" id="L538">                        HttpServletRequest request = GuiceContext.inject().getInstance(HttpServletRequest.class);</span>
<span class="nc" id="L539">                        StringBuffer url = request.getRequestURL();</span>
<span class="nc" id="L540">                        sb = sb.insert(0, url);</span>
<span class="nc" id="L541">                        sb = new StringBuilder(sb.toString().replaceAll(&quot;jwcordova&quot;, &quot;&quot;).replaceAll(&quot;jwajax&quot;, &quot;&quot;));</span>
                    }
                }
<span class="fc" id="L544">                catch (NoClassDefFoundError | Exception e)</span>
                {

<span class="fc" id="L547">                }</span>
            }

<span class="fc" id="L550">            return sb.toString();</span>
        }
        else
        {
<span class="fc" id="L554">            StringBuilder sb = new StringBuilder(getRemoteReference());</span>
<span class="pc bpc" id="L555" title="3 of 4 branches missed.">            if (useMinAtEndOfExtension &amp;&amp; isCanMinifyAtRemote())</span>
            {
<span class="nc bnc" id="L557" title="All 2 branches missed.">                if (!sb.toString().contains(&quot;.min.&quot;))</span>
                {
<span class="nc" id="L559">                    sb.insert(sb.lastIndexOf(&quot;.&quot;), &quot;.min&quot;);</span>
                }
            }
<span class="fc" id="L562">            return sb.toString();</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>