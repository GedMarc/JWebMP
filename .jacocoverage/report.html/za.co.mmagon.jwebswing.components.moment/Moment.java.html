<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Moment.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;JWebSwing&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">za.co.mmagon.jwebswing.components.moment</a> &gt; <span class="el_source">Moment.java</span></div><h1>Moment.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2015 Marc Magon
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package za.co.mmagon.jwebswing.components.moment;

import java.text.NumberFormat;
import java.text.SimpleDateFormat;
import java.util.*;
import za.co.mmagon.jwebswing.base.html.Div;
import za.co.mmagon.jwebswing.base.html.interfaces.GlobalChildren;
import za.co.mmagon.jwebswing.base.servlets.enumarations.ComponentTypes;

/**
 * The Moment.js implementation
 * &lt;p&gt;
 * @author Marc Magon
 * @since 29 Aug 2015
 * @version 1.0
 */
public class Moment extends Div&lt;MomentChildren, MomentAttributes, MomentFeatures, MomentEvents, Moment&gt; implements GlobalChildren
{

    private static final long serialVersionUID = 1L;

    private static MomentAngularModule angularModule;

    private MomentFeature feature;

    private Date assignedDate;
    private String variableName;

    private Map&lt;MomentFilters, String&gt; appliedFilters;

    /**
     * Constructs an empty moment component
     */
    public Moment()
<span class="nc" id="L51">    {</span>

<span class="nc" id="L53">    }</span>

    /**
     * Constructs a new moment with the given date and tag type
     *
     * @param assignedDate The date to use
     * @param myComponent  THe component tag to use
     */
    public Moment(Date assignedDate, ComponentTypes myComponent)
    {
<span class="fc" id="L63">        super(myComponent);</span>
<span class="fc" id="L64">        this.assignedDate = assignedDate;</span>
<span class="fc" id="L65">    }</span>

    /**
     * Constructs a new moment with the given angular variable name
     *
     * @param variableName The angular variable name to use
     * @param myComponent  The component type to use
     */
    public Moment(String variableName, ComponentTypes myComponent)
    {
<span class="nc" id="L75">        super(myComponent);</span>
<span class="nc" id="L76">        this.variableName = variableName;</span>
<span class="nc" id="L77">    }</span>

    /**
     * Constructs a new DIV with the given date
     *
     * @param assignedDate The date to use
     */
    public Moment(Date assignedDate)
<span class="fc" id="L85">    {</span>
<span class="fc" id="L86">        this.assignedDate = assignedDate;</span>
<span class="fc" id="L87">    }</span>

    /**
     * Constructs a new DIV with the given angular variable
     *
     * @param variableName the new angular variable
     */
    public Moment(String variableName)
<span class="nc" id="L95">    {</span>
<span class="nc" id="L96">        this.variableName = variableName;</span>
<span class="nc" id="L97">    }</span>

    /**
     * Returns the given feature
     *
     * @return
     */
    public final MomentFeature getFeature()
    {
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">        if (feature == null)</span>
        {
<span class="fc" id="L108">            feature = new MomentFeature(this);</span>
        }
<span class="fc" id="L110">        return feature;</span>
    }

    /**
     * Returns no Options
     *
     * @return No options available for a moment
     */
    @Override
    public MomentOptions getOptions()
    {
<span class="nc" id="L121">        return getFeature().getOptions();</span>
    }
    

    /**
     * Returns the assigned date
     *
     * @return
     */
    public Date getAssignedDate()
    {
<span class="nc" id="L132">        return assignedDate;</span>
    }

    /**
     * Returns the assigned date
     *
     * @param assignedDate
     */
    public void setAssignedDate(Date assignedDate)
    {
<span class="nc" id="L142">        this.assignedDate = assignedDate;</span>
<span class="nc" id="L143">    }</span>

    /**
     * Returns the assigned variable name
     *
     * @return
     */
    public String getVariableName()
    {
<span class="nc" id="L152">        return variableName;</span>
    }

    /**
     * Sets the assigned variable name
     *
     * @param variableName
     */
    public void setVariableName(String variableName)
    {
<span class="nc" id="L162">        this.variableName = variableName;</span>
<span class="nc" id="L163">    }</span>

    /**
     * Return the HashMap of filters applied to this moment
     *
     * @return
     */
    public Map&lt;MomentFilters, String&gt; getAppliedFilters()
    {
<span class="fc bfc" id="L172" title="All 2 branches covered.">        if (appliedFilters == null)</span>
        {
<span class="fc" id="L174">            appliedFilters = new HashMap&lt;&gt;();</span>
        }
<span class="fc" id="L176">        return appliedFilters;</span>
    }

    /**
     * Sets this moment list of applied filters
     *
     * @param appliedFilters
     */
    public void setAppliedFilters(HashMap&lt;MomentFilters, String&gt; appliedFilters)
    {
<span class="nc" id="L186">        this.appliedFilters = appliedFilters;</span>
<span class="nc" id="L187">    }</span>

    @Override
    public void preConfigure()
    {
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">        if (!isConfigured())</span>
        {
<span class="fc" id="L194">            addFeature(getFeature());</span>
<span class="fc bfc" id="L195" title="All 2 branches covered.">            if (angularModule == null)</span>
            {
<span class="fc" id="L197">                angularModule = new MomentAngularModule(getPage());</span>
            }
<span class="fc" id="L199">            getAngularModules().add(angularModule);</span>
<span class="fc" id="L200">            addAttribute(MomentAttributes.am_time_ago, buildAttributeString());</span>
<span class="fc" id="L201">            getPage().getOptions().setAngularEnabled(true);</span>
        }
<span class="fc" id="L203">        super.preConfigure();</span>
<span class="fc" id="L204">    }</span>

    /**
     * Builds the list of given filters
     *
     * @return
     */
    private String buildAttributeString()
    {
<span class="fc" id="L213">        StringBuilder sb = new StringBuilder();</span>
<span class="pc bpc" id="L214" title="1 of 2 branches missed.">        if (variableName != null)</span>
        {
<span class="nc" id="L216">            sb.append(variableName);</span>
        }
<span class="fc bfc" id="L218" title="All 2 branches covered.">        else if (assignedDate != null)</span>
        {
<span class="fc" id="L220">            sb.append(&quot;'&quot;).append(DateFormatter.format(assignedDate)).append(&quot;'&quot;);</span>
<span class="fc" id="L221">            getAppliedFilters().put(MomentFilters.amParse, &quot;YYYY-MM-DD HH:mm:ss&quot;);</span>
        }
<span class="fc bfc" id="L223" title="All 2 branches covered.">        if (!getAppliedFilters().isEmpty())</span>
        {
<span class="fc" id="L225">            getAppliedFilters().entrySet().stream().forEach((entry)</span>
                    -&gt;
            {
<span class="fc" id="L228">                MomentFilters key = entry.getKey();</span>
<span class="fc" id="L229">                String value = entry.getValue();</span>
<span class="pc bpc" id="L230" title="1 of 2 branches missed.">                if (value != null)</span>
                {
<span class="fc" id="L232">                    sb.append(&quot; | &quot;).append(key).append(&quot; : '&quot;).append(value).append(&quot;'&quot;);</span>
                }
                else
                {
<span class="nc" id="L236">                    sb.append(&quot; | &quot;).append(key);</span>
                }
<span class="fc" id="L238">            });</span>
        }
<span class="fc" id="L240">        return sb.toString();</span>
    }

    /**
     * The default date formatter which is parsed
     */
<span class="fc" id="L246">    private static final SimpleDateFormat DateFormatter = (SimpleDateFormat) SimpleDateFormat.getInstance();// new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span>

    static
    {
<span class="fc" id="L250">        DateFormatter.applyPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span>
    }

    /**
     * Parses a custom-formatted date into a moment object that can be used with the am-time-ago directive and the other filters. For example, the following code will accept dates that are formatted
     * like &quot;2015.04.25 22:00:15':
     * &lt;p&gt;
     * am-time-ago=&quot;message.time | amParse:'YYYY.MM.DD HH:mm:ss'&quot;
     * &lt;p&gt;
     * Note: To use amParse, install angular-moment version 1.0.0-beta.3 or newer
     *
     * @param parseSyntax
     */
    public void AddParseFilter(String parseSyntax)
    {
<span class="nc" id="L265">        getAppliedFilters().put(MomentFilters.amParse, parseSyntax);</span>
<span class="nc" id="L266">    }</span>

    /**
     * Converts a unix-timestamp (seconds since 1/1/1970) into a moment object. Example:
     * &lt;p&gt;
     * span am-time-ago=&quot;message.unixTime | amFromUnix&quot;
     */
    public void AddFromUnixFilter()
    {
<span class="nc" id="L275">        getAppliedFilters().put(MomentFilters.amFromUnix, null);</span>
<span class="nc" id="L276">    }</span>

    /**
     * Create / switch the current moment object into UTC mode. For example, given a date object in message.date, the following code will display the time in UTC instead of the local timezone:
     * &lt;p&gt;
     * {{message.date | amUtc | amDateFormat:'MM.DD.YYYY HH:mm:ss'}}
     */
    public void AddUtc()
    {
<span class="nc" id="L285">        getAppliedFilters().put(MomentFilters.amUtc, null);</span>
<span class="nc" id="L286">    }</span>

<span class="fc" id="L288">    private static final NumberFormat nf = NumberFormat.getInstance();</span>

    static
    {
<span class="fc" id="L292">        nf.setGroupingUsed(false);</span>
<span class="fc" id="L293">        nf.setMaximumFractionDigits(2);</span>
<span class="fc" id="L294">        nf.setMinimumIntegerDigits(2);</span>
<span class="fc" id="L295">    }</span>

    /**
     * Uses the given U offset when displaying a date. For example, the following code will display the date with a UTC + 3 hours time offset:
     * &lt;p&gt;
     * {{message.date | amUtcOffset:'+0300' | amDateFormat:'MM.DD.YYYY HH:mm:ss'}}/span
     *
     * @param timeToChange the time to change, use like 3.0, or 3.30
     */
    public void AddUtcOffsetFilter(double timeToChange)
    {
<span class="nc" id="L306">        String timeSet = &quot;+&quot; + nf.format(timeToChange).replace(&quot;.&quot;, &quot;&quot;);</span>
<span class="nc" id="L307">        getAppliedFilters().put(MomentFilters.amUtcOffset, timeSet);</span>
<span class="nc" id="L308">    }</span>

    /**
     * Changes the given moment object to be in the local timezone. Usually used in conjunction with amUtc / amTimezone for timezone conversion. For example, the following will convert the given UTC
     * date to local time:
     * &lt;p&gt;
     * {{message.date | amUtc | amLocal | amDateFormat:'MM.DD.YYYY HH:mm:ss'}}
     */
    public void AddLocalFilter()
    {
<span class="nc" id="L318">        getAppliedFilters().put(MomentFilters.amLocal, null);</span>
<span class="nc" id="L319">    }</span>

    /**
     * TODO this guy needs to get done https://github.com/urish/angular-moment
     */
    public void AddTimezoneFilter()
    {

<span class="nc" id="L327">    }</span>

    /**
     * Format dates using moment.js format() method. Example:
     * &lt;p&gt;
     * {{message.time | amDateFormat:'dddd, MMMM Do YYYY, h:mm:ss a'}}
     * &lt;p&gt;
     * This snippet will format the given time as &quot;Monday, October 7th 2013, 12:36:29 am&quot;.
     *
     * @param dateformat
     */
    public void AddDateFormatFilter(String dateformat)
    {
<span class="nc" id="L340">        getAppliedFilters().put(MomentFilters.amDateeFormat, dateformat);</span>
<span class="nc" id="L341">    }</span>

    /**
     * Format dates using moment.js calendar() method. Example:
     * &lt;p&gt;
     * span&amp;gt;{{message.time | amCalendar:referenceTime:formats}}/span
     * &lt;p&gt;
     * This snippet will format the given time as e.g. &quot;Today 2:30 AM&quot; or &quot;Last Monday 2:30 AM&quot; etc..
     */
    public void AddCalendarFilter()
    {
<span class="nc" id="L352">        getAppliedFilters().put(MomentFilters.amCalendar, &quot;referenceTime:formats&quot;);</span>
<span class="nc" id="L353">    }</span>

    /**
     * TODO this guy... ;/ https://github.com/urish/angular-moment
     */
    public void AddDifferenceFilter()
    {
<span class="nc" id="L360">        getAppliedFilters().put(MomentFilters.amDifference, &quot;referenceTime:formats&quot;);</span>
<span class="nc" id="L361">    }</span>

    /**
     * Formats a duration (such as 5 days) in a human readable format. See Moment.JS documentation for a list of supported duration formats, and humanize() documentation for explanation about the
     * formatting algorithm.
     * &lt;p&gt;
     * Example:
     * &lt;p&gt;
     * Message age: {{message.ageInMinutes | amDurationFormat : 'minute' }}
     * &lt;p&gt;
     * Will display the age of the message (e.g. 10 minutes, 1 hour, 2 days, etc).
     *
     * @param duration
     */
    public void AddDurationFilter(DurationFilters duration)
    {
<span class="nc" id="L377">        getAppliedFilters().put(MomentFilters.amDurationFormat, duration.toString());</span>
<span class="nc" id="L378">    }</span>

    /**
     * Subtract values (hours, minutes, seconds ...) from a specified date.
     *
     * @param amount
     * @param part
     */
    public void AddSubtractionFilter(int amount, DurationFilters part)
    {
<span class="nc" id="L388">        getAppliedFilters().put(MomentFilters.amSubtract, &quot;&quot; + amount + &quot;' : '&quot; + part.toString() + &quot;&quot;);</span>
<span class="nc" id="L389">    }</span>

    /**
     * Adds values (hours, minutes, seconds ...) from a specified date.
     *
     * @param amount
     * @param part
     */
    public void AddAdditionFilter(int amount, DurationFilters part)
    {
<span class="nc" id="L399">        getAppliedFilters().put(MomentFilters.amAdd, &quot;&quot; + amount + &quot;' : '&quot; + part.toString() + &quot;&quot;);</span>
<span class="nc" id="L400">    }</span>

    /**
     * The available descernable parts
     */
<span class="nc" id="L405">    public enum DurationFilters</span>
    {
<span class="nc" id="L407">        Years,</span>
<span class="nc" id="L408">        Hours,</span>
<span class="nc" id="L409">        Minutes,</span>
<span class="nc" id="L410">        Days,</span>
<span class="nc" id="L411">        Months,</span>
<span class="nc" id="L412">        Seconds;</span>

        @Override
        public String toString()
        {
<span class="nc" id="L417">            return name().toLowerCase();</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>