<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Page.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;JWebSwing&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">za.co.mmagon.jwebswing</a> &gt; <span class="el_source">Page.java</span></div><h1>Page.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2016 ged_m
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package za.co.mmagon.jwebswing;

import com.fasterxml.jackson.annotation.JsonIgnore;
import java.util.*;
import java.util.List;
import javax.servlet.http.HttpSession;
import net.sf.uadetector.*;
import za.co.mmagon.JWebSwingSiteBinder;
import za.co.mmagon.jwebswing.base.ComponentHierarchyBase;
import za.co.mmagon.jwebswing.base.angular.AngularFeature;
import za.co.mmagon.jwebswing.base.client.InternetExplorerCompatibilityMode;
import za.co.mmagon.jwebswing.base.html.*;
import za.co.mmagon.jwebswing.base.html.attributes.ScriptAttributes;
import za.co.mmagon.jwebswing.base.html.interfaces.children.HeadChildren;
import za.co.mmagon.jwebswing.base.references.CSSReference;
import za.co.mmagon.jwebswing.base.references.JavascriptReference;
import za.co.mmagon.jwebswing.base.servlets.JWebSwingServlet;
import za.co.mmagon.jwebswing.base.servlets.enumarations.RequirementsPriority;
import za.co.mmagon.jwebswing.base.servlets.interfaces.IPage;
import za.co.mmagon.jwebswing.generics.WebReference;

/**
 * Top level of any HTML page.
 * &lt;p&gt;
 * Has only two children, head and body.
 * &lt;p&gt;
 * Sometimes scripts are added right at the end but we try to avoid that as much as possible.
 *
 * @author GedMarc
 * @since 24 Apr 2016
 * @version 2.0
 *
 * Replacement of the old page object
 */
public class Page extends Html implements IPage
{

    private static final long serialVersionUID = 1L;
    /**
     * The options available
     */
    private PageOptions options;
    /**
     * The fields available
     */
    private PageFields fields;

    /**
     * The current user agent of the render
     */
    @JsonIgnore
    private transient ReadableUserAgent userAgent;
    /**
     * The Servlet attached to this page
     */
    @JsonIgnore
    private transient JWebSwingServlet servlet;
    /**
     * The session of this page
     */
    @JsonIgnore
    private transient HttpSession session;

    /**
     * The angular feature
     */
    private AngularFeature angular;

    /**
     * Cache for all the associated components throughout the life-cycle of the application
     */
    private transient HashMap&lt;String, ComponentHierarchyBase&gt; componentCache;

    /**
     * Populates all my components. Excludes this page
     */
    /**
     * @param title             Sets the title of the page
     * @param compatibilityMode Sets the Internet explorer mode to work on
     * @param base              Sets the base tag for the page. Convenience Parameter
     */
    public Page(Title title, InternetExplorerCompatibilityMode compatibilityMode, Base base)
<span class="fc" id="L99">    {</span>
<span class="fc" id="L100">        getPageFields().setTitle(title);</span>
<span class="fc" id="L101">        getPageFields().setCompatibilityMode(compatibilityMode);</span>
<span class="fc" id="L102">        getPageFields().setBase(base);</span>
<span class="fc" id="L103">        setID(&quot;jwPage&quot;);</span>
        //setGenerator(&quot;JWebSwing - https://sourceforge.net/projects/jwebswing/&quot;);
<span class="fc" id="L105">    }</span>

    /**
     * @param title             Sets the title of the page
     * @param compatibilityMode Sets the Internet explorer mode to work on
     */
    public Page(Title title, InternetExplorerCompatibilityMode compatibilityMode)
    {
<span class="nc" id="L113">        this(title, compatibilityMode, null);</span>
<span class="nc" id="L114">    }</span>

    /**
     * @param title Sets the title of the page
     */
    public Page(Title title)
    {
<span class="nc" id="L121">        this(title, null, null);</span>
<span class="nc" id="L122">    }</span>

    /**
     * @param title Sets the title of the page
     */
    public Page(String title)
    {
<span class="nc" id="L129">        this(new Title(title), null, null);</span>
<span class="nc" id="L130">    }</span>

    /**
     * Constructs an empty page object
     */
    public Page()
    {
<span class="fc" id="L137">        this(null, null, null);</span>
<span class="fc" id="L138">    }</span>

    /**
     * Renders all the children to a string builder
     *
     * @return
     */
    @Override
    protected StringBuilder renderChildren()
    {
<span class="fc" id="L148">        StringBuilder pageOutput = new StringBuilder();</span>
<span class="fc" id="L149">        StringBuilder bodyOutput = null;</span>

<span class="fc bfc" id="L151" title="All 2 branches covered.">        if (!isBodyEmpty())</span>
        {
<span class="fc" id="L153">            bodyOutput = new StringBuilder(getBody().toString(1));</span>
        }
        
<span class="fc bfc" id="L156" title="All 2 branches covered.">        if (!isHeadEmpty())</span>
        {
<span class="fc" id="L158">            pageOutput.append(getNewLine()).append(getCurrentTabIndentString()).append(getHead().toString(1));</span>
        }
<span class="fc bfc" id="L160" title="All 2 branches covered.">        if (bodyOutput != null)</span>
        {
<span class="fc" id="L162">            pageOutput.append(getNewLine()).append(getCurrentTabIndentString()).append(bodyOutput);</span>
        }
<span class="fc" id="L164">        return pageOutput;</span>
    }

    @Override
    public void init()
    {
<span class="pc bpc" id="L170" title="1 of 2 branches missed.">        if (!isInitialized())</span>
        {
<span class="fc" id="L172">            getBody().init();</span>
        }
<span class="fc" id="L174">        super.init();</span>
<span class="fc" id="L175">    }</span>

    /**
     * Configures the page and all its components
     */
    @Override
    public void preConfigure()
    {
<span class="fc bfc" id="L183" title="All 2 branches covered.">        if (!isInitialized())</span>
        {
<span class="fc" id="L185">            init();</span>
        }
<span class="pc bpc" id="L187" title="1 of 2 branches missed.">        if (!isConfigured())</span>
        {
<span class="fc" id="L189">            getBody().init();</span>
<span class="fc" id="L190">            getBody().preConfigure();</span>
<span class="fc" id="L191">            getAngular().preConfigure();</span>

<span class="fc" id="L193">            configurePageHeader();</span>

<span class="fc" id="L195">            addVariablesScriptToPage();</span>

<span class="fc" id="L197">            addScriptsToBody();</span>

<span class="fc" id="L199">            List&lt;Script&gt; allScripts = getDynamicScripts();</span>

<span class="pc bpc" id="L201" title="1 of 2 branches missed.">            allScripts.stream().filter(script -&gt; (script != null)).forEach(getBody()::add);</span>

<span class="fc" id="L203">            getTopShelfScripts().forEach(next -&gt;</span>
            {
<span class="fc" id="L205">                getHead().add((HeadChildren) next);</span>
<span class="fc" id="L206">            });</span>

<span class="fc" id="L208">            ArrayList&lt;ComponentHierarchyBase&gt; requirements = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L210" title="All 2 branches covered.">            for (RequirementsPriority priority : RequirementsPriority.values())</span>
            {
<span class="fc" id="L212">                getPriorityRequirements(priority, requirements, true, false).stream().forEach((comp) -&gt;</span>
                {
<span class="fc" id="L214">                    getHead().getChildren().add(comp);</span>
<span class="fc" id="L215">                });</span>
            }
<span class="fc" id="L217">            getHead().add((HeadChildren) getCssStyle());</span>

<span class="fc" id="L219">            buildComponentHierarchy();</span>
        }
<span class="fc" id="L221">        super.preConfigure();</span>
<span class="fc" id="L222">    }</span>

    /**
     * Returns the component with only it's methods
     *
     * @return
     */
    public IPage asMe()
    {
<span class="nc" id="L231">        return this;</span>
    }

    /**
     * Returns this pages current component cache
     *
     * @return
     */
    @Override
    public java.util.Map&lt;String, ComponentHierarchyBase&gt; getComponentCache()
    {
<span class="fc bfc" id="L242" title="All 2 branches covered.">        if (componentCache == null)</span>
        {
<span class="fc" id="L244">            componentCache = new HashMap&lt;&gt;();</span>
        }
<span class="fc" id="L246">        return componentCache;</span>
    }

    /**
     * Returns all the components currently associated with this page
     *
     * @return
     */
    @Override
    public List&lt;ComponentHierarchyBase&gt; getAllComponents()
    {
<span class="nc" id="L257">        return (List&lt;ComponentHierarchyBase&gt;) getComponentCache().values();</span>
    }

    /**
     * Builds the component hierarchy from scratch
     */
    public void buildComponentHierarchy()
    {
        //getComponentCache().clear();
<span class="fc" id="L266">        getComponentCache().put(getBody().getID(), getBody());</span>
<span class="fc" id="L267">        buildComponentHierarchy(getBody(), getComponentCache());</span>
<span class="fc" id="L268">    }</span>

    /**
     * Builds up or adds components to the page
     *
     * @param startingPoint The starting component to update with
     * @param addToMap      The map to add to
     */
    public void buildComponentHierarchy(ComponentHierarchyBase startingPoint, java.util.Map&lt;String, ComponentHierarchyBase&gt; addToMap)
    {
<span class="pc bpc" id="L278" title="1 of 2 branches missed.">        startingPoint.getChildren().stream().filter(child -&gt; !(child == null)).map(child</span>
                -&gt;
        {
<span class="fc" id="L281">            ComponentHierarchyBase c = (ComponentHierarchyBase) child;</span>
<span class="fc" id="L282">            addToMap.put(c.getID(), c);</span>
<span class="fc" id="L283">            return child;</span>
<span class="fc" id="L284">        }).forEach(child</span>
                -&gt;
        {
<span class="fc" id="L287">            ComponentHierarchyBase c = (ComponentHierarchyBase) child;</span>
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">            if (child != null)</span>
            {
<span class="fc" id="L290">                buildComponentHierarchy(c, addToMap);</span>
            }
<span class="fc" id="L292">        });</span>
<span class="fc" id="L293">    }</span>

    /**
     * Sets the current component cache
     *
     * @param componentCache
     */
    public void setComponentCache(HashMap&lt;String, ComponentHierarchyBase&gt; componentCache)
    {
<span class="nc" id="L302">        this.componentCache = componentCache;</span>
<span class="nc" id="L303">    }</span>

    /**
     * Returns the style object. If dynamic rendering is enabled it will point to the Servlet.
     *
     * @return
     */
    public ComponentHierarchyBase getCssStyle()
    {
<span class="fc" id="L312">        StringBuilder css = getBody().renderCss(0);</span>
<span class="pc bpc" id="L313" title="1 of 2 branches missed.">        if (!css.toString().isEmpty())</span>
        {
<span class="nc bnc" id="L315" title="All 2 branches missed.">            if (getOptions().isDynamicRender())</span>
            {
<span class="nc" id="L317">                CSSLink renderedCSS = new CSSLink(JWebSwingSiteBinder.CSSLocation.replaceAll(&quot;/&quot;, &quot;&quot;));</span>
<span class="nc" id="L318">                return renderedCSS;</span>
            }
            else
            {
<span class="nc bnc" id="L322" title="All 2 branches missed.">                if (css.length() &gt; 0)</span>
                {
<span class="nc" id="L324">                    Style style = new Style();</span>
<span class="nc" id="L325">                    style.setText(css);</span>
<span class="nc" id="L326">                    return style;</span>
                }
            }
        }
<span class="fc" id="L330">        return null;</span>
    }

    /**
     * Returns the top shelf script and css references
     *
     * @return
     */
    private List&lt;ComponentHierarchyBase&gt; getTopShelfScripts()
    {
        List&lt;ComponentHierarchyBase&gt; arr;
<span class="fc" id="L341">        arr = getPriorityRequirements(RequirementsPriority.Top_Shelf, new ArrayList&lt;&gt;(), true, true);</span>
<span class="fc" id="L342">        return arr;</span>
    }

    /**
     * Returns the script reference
     *
     * @return ArrayList of type script
     */
    private List&lt;Script&gt; getDynamicScripts()
    {
<span class="fc" id="L352">        ArrayList&lt;Script&gt; allScripts = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L354" title="All 2 branches covered.">        if (getOptions().isAngularEnabled())</span>
        {
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">            if (getOptions().isDynamicRender())</span>
            {
<span class="nc" id="L358">                Script dynamicScript = new Script();</span>
<span class="nc" id="L359">                dynamicScript.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="nc" id="L360">                dynamicScript.addAttribute(ScriptAttributes.Src,  JWebSwingSiteBinder.AngularScriptLocation.replaceAll(&quot;/&quot;, &quot;&quot;));</span>
                //dynamicScript.setTiny(true);
                //dynamicScript.setText(&quot;$.ajax({cache:false,async:false,dataType:'script',url:'as'}).fail(function(){alert('session lost'); });&quot;);
<span class="nc" id="L363">                allScripts.add(dynamicScript);</span>
<span class="nc" id="L364">            }</span>
            else
            {
<span class="fc" id="L367">                StringBuilder js = getAngular().renderTemplateScripts(&quot;jwangular&quot;);// getBody().renderJavascriptAll();</span>
<span class="pc bpc" id="L368" title="1 of 2 branches missed.">                if (!js.toString().trim().isEmpty())</span>
                {
<span class="fc" id="L370">                    Script s = new Script();</span>
<span class="fc" id="L371">                    s.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="fc" id="L372">                    s.setText(js);</span>
<span class="fc" id="L373">                    allScripts.add(s);</span>
                }
            }
        }

<span class="fc bfc" id="L378" title="All 2 branches covered.">        if (getOptions().isDynamicRender())</span>
        {
<span class="fc" id="L380">            StringBuilder js = renderJavascript();</span>
<span class="fc bfc" id="L381" title="All 2 branches covered.">            if (!js.toString().trim().isEmpty())</span>
            {
<span class="fc" id="L383">                Script dynamicScript = new Script();</span>
<span class="fc" id="L384">                dynamicScript.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="fc" id="L385">                dynamicScript.addAttribute(ScriptAttributes.Src, JWebSwingSiteBinder.JavaScriptLocation.replaceAll(&quot;/&quot;, &quot;&quot;));</span>
                //dynamicScript.setTiny(true);
                //dynamicScript.setText(&quot;$.ajax({cache:false,dataType:'script',url:'js'}).fail(function(){alert('session lost'); });&quot;);
<span class="fc" id="L388">                allScripts.add(dynamicScript);</span>
            }
<span class="fc" id="L390">        }</span>
        else
        {
<span class="fc" id="L393">            StringBuilder js = renderJavascript();</span>
<span class="fc bfc" id="L394" title="All 2 branches covered.">            if (!js.toString().trim().isEmpty())</span>
            {
<span class="fc" id="L396">                Script s = new Script();</span>
<span class="fc" id="L397">                s.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="fc" id="L398">                s.setText(js);</span>
<span class="fc" id="L399">                allScripts.add(s);</span>
            }
        }

<span class="fc" id="L403">        return allScripts;</span>
    }

    /**
     * Builds up the Header Tag
     */
    private void configurePageHeader()
    {
<span class="fc bfc" id="L411" title="All 2 branches covered.">        if (getPageFields().getTitle() != null)</span>
        {
<span class="fc" id="L413">            getHead().add(getPageFields().getTitle());</span>
        }
<span class="fc bfc" id="L415" title="All 2 branches covered.">        if (getPageFields().getBase() != null)</span>
        {
<span class="fc" id="L417">            getHead().add(getPageFields().getBase());</span>
        }
<span class="fc" id="L419">        getHead().add(getPageFields().getHttpEquivMeta());</span>
<span class="fc" id="L420">        getHead().add(getPageFields().getCacheControl());</span>
<span class="fc" id="L421">        getHead().add(getPageFields().getAuthor());</span>
<span class="fc" id="L422">        getHead().add(getPageFields().getApplicationName());</span>
<span class="fc" id="L423">        getHead().add(getPageFields().getGenerator());</span>
<span class="fc" id="L424">        getHead().add(getPageFields().getDescription());</span>
<span class="fc" id="L425">        getHead().add(getPageFields().getKeywords());</span>
<span class="fc" id="L426">        getHead().add(getPageFields().getFavIconLink());</span>

<span class="fc" id="L428">        getHead().getChildren().stream().forEach((headObject)</span>
                -&gt;
        {
<span class="fc" id="L431">            headObject.init();</span>
<span class="fc" id="L432">            headObject.preConfigure();</span>
<span class="fc" id="L433">        });</span>
<span class="fc" id="L434">    }</span>

    /**
     * Adds the variables in the application to the collection
     */
    private void addVariablesScriptToPage()
    {
<span class="fc" id="L441">        StringBuilder variablesScriptBuilder = new StringBuilder();</span>
<span class="fc bfc" id="L442" title="All 2 branches covered.">        for (Iterator it = getBody().getVariablesAll().iterator(); it.hasNext();)</span>
        {
<span class="fc" id="L444">            String var = (String) it.next();</span>
<span class="fc" id="L445">            variablesScriptBuilder.append(&quot;var &quot;).append(var).append(&quot;;&quot;);</span>
<span class="fc" id="L446">        }</span>
<span class="fc bfc" id="L447" title="All 2 branches covered.">        if (variablesScriptBuilder.length() &gt; 0)</span>
        {
<span class="fc" id="L449">            Script variablesScript = new Script();</span>
<span class="fc" id="L450">            variablesScript.setID(&quot;variables&quot;);</span>
<span class="fc" id="L451">            variablesScript.setNewLineForRawText(true);</span>
<span class="fc" id="L452">            variablesScript.addAttribute(ScriptAttributes.Type, &quot;text/javascript&quot;);</span>
<span class="fc" id="L453">            variablesScript.setText(variablesScriptBuilder.toString());</span>
<span class="pc bpc" id="L454" title="1 of 2 branches missed.">            if (!getHead().getChildren().contains(variablesScript))</span>
            {
<span class="fc" id="L456">                getHead().add(variablesScript);</span>
            }
        }
<span class="fc" id="L459">    }</span>

    private void addScriptsToBody()
    {
<span class="fc" id="L463">        List&lt;ComponentHierarchyBase&gt; requirements = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L465">        List&lt;RequirementsPriority&gt; arrs = new ArrayList&lt;&gt;(Arrays.asList(RequirementsPriority.values()));</span>
        //render JS only
<span class="fc bfc" id="L467" title="All 2 branches covered.">        arrs.stream().filter(a -&gt; a != RequirementsPriority.Top_Shelf).map(priority -&gt;</span>
        {
<span class="fc bfc" id="L469" title="All 2 branches covered.">            if (!getPriorityRequirements(priority, requirements, true, false).isEmpty())</span>
            {
                //getBody().add(new Comment(&quot;Priority [&quot; + priority + &quot;] Values&quot;));
            }
<span class="fc" id="L473">            return priority;</span>
<span class="fc" id="L474">        }).forEachOrdered(priority -&gt;</span>
        {
<span class="fc" id="L476">            getPriorityRequirements(priority, requirements, false, true).stream().forEach(comp</span>
                    -&gt;
            {
<span class="fc" id="L479">                getBody().add(comp);</span>
<span class="fc" id="L480">            });</span>
<span class="fc" id="L481">        });</span>
<span class="fc" id="L482">    }</span>

    /**
     * Adds all the stuff for a given priority
     *
     * @param css        CSS
     * @param input      the hierarchy to read from
     * @param priority   the priority
     * @param javascript to return JavaScript or not
     */
    private List&lt;ComponentHierarchyBase&gt; getPriorityRequirements(RequirementsPriority priority, List&lt;ComponentHierarchyBase&gt; input, boolean css, boolean javascript)
    {
<span class="fc" id="L494">        List&lt;ComponentHierarchyBase&gt; requirements = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L495" title="All 2 branches covered.">        if (css)</span>
        {
<span class="pc bpc" id="L497" title="2 of 4 branches missed.">            getAllCssLinks(priority).stream().filter(cssLink -&gt; (!input.contains(cssLink) &amp;&amp; !requirements.contains(cssLink))).forEach(cssLink</span>
                    -&gt;
            {
<span class="fc" id="L500">                requirements.add(cssLink);</span>
<span class="fc" id="L501">            });</span>
        }
<span class="fc bfc" id="L503" title="All 2 branches covered.">        if (javascript)</span>
        {
<span class="pc bpc" id="L505" title="2 of 4 branches missed.">            getAllScripts(priority).stream().filter(script -&gt; (!input.contains(script) &amp;&amp; !requirements.contains(script))).forEach(script</span>
                    -&gt;
            {
<span class="fc" id="L508">                requirements.add(script);</span>
<span class="fc" id="L509">            });</span>
        }

<span class="fc" id="L512">        return requirements;</span>
    }

    /**
     * Gets all the links for all the bodies components
     *
     * @param priority
     *
     * @return
     */
    private List&lt;CSSLink&gt; getAllCssLinks(RequirementsPriority priority)
    {
<span class="fc" id="L524">        List&lt;CSSReference&gt; allReferences = getBody().getCssReferencesAll(priority);</span>
<span class="fc" id="L525">        allReferences.sort(WebReference.getDummyReference());</span>
<span class="fc" id="L526">        ArrayList&lt;CSSLink&gt; allLinks = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L527">        allReferences.stream().map(ref -&gt; new CSSLink(ref)).forEach(allLinks::add);</span>
<span class="fc" id="L528">        return allLinks;</span>
    }

    /**
     * Gets all the scripts for all the body components
     *
     * @param priority
     *
     * @return
     */
    private List&lt;Script&gt; getAllScripts(RequirementsPriority priority)
    {
<span class="fc" id="L540">        List&lt;JavascriptReference&gt; allJavascripts = getBody().getJavascriptReferencesAll(priority);</span>
<span class="fc" id="L541">        allJavascripts.sort(WebReference.getDummyReference());</span>
<span class="fc" id="L542">        ArrayList&lt;Script&gt; allScripts = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L543">        allJavascripts.stream().map(js -&gt; new Script(js)).forEach(s</span>
                -&gt;
        {
<span class="fc" id="L546">            s.setNewLineForClosingTag(false);</span>
<span class="fc" id="L547">            allScripts.add(s);</span>
<span class="fc" id="L548">        });</span>
<span class="fc" id="L549">        return allScripts;</span>
    }

    /**
     * Returns if the head object is empty
     *
     * @return
     */
    private boolean isHeadEmpty()
    {
<span class="fc" id="L559">        return getHead().getChildren().isEmpty();</span>
    }

    /**
     * Returns if the body object is empty
     *
     * @return
     */
    private boolean isBodyEmpty()
    {
<span class="fc" id="L569">        return getBody().getChildren().isEmpty();</span>
    }

    /**
     * Returns a readable user agent, or null if just a basic render
     *
     * @return
     */
    public ReadableUserAgent getUserAgent()
    {
<span class="nc bnc" id="L579" title="All 2 branches missed.">        if (userAgent == null)</span>
        {
<span class="nc" id="L581">            userAgent = new UserAgent(DeviceCategory.EMPTY, UserAgentFamily.FIREFOX, &quot;&quot;, &quot;&quot;, OperatingSystem.EMPTY, &quot;&quot;, &quot;&quot;, UserAgentType.BROWSER, &quot;&quot;, &quot;&quot;, VersionNumber.UNKNOWN);</span>
        }
<span class="nc" id="L583">        return userAgent;</span>
    }

    /**
     * Sets the userAgent
     *
     * @param userAgent
     */
    public void setUserAgent(ReadableUserAgent userAgent)
    {
<span class="nc" id="L593">        this.userAgent = userAgent;</span>
<span class="nc" id="L594">    }</span>

    /**
     * Returns all the dynamic options for a page
     *
     * @return
     */
    @Override
    public final PageOptions getOptions()
    {
<span class="fc bfc" id="L604" title="All 2 branches covered.">        if (options == null)</span>
        {
<span class="fc" id="L606">            options = new PageOptions(this);</span>
        }
<span class="fc" id="L608">        return options;</span>
    }

    /**
     * Returns the fields available for entry on this page
     *
     * @return
     */
    @Override
    public final PageFields getPageFields()
    {
<span class="fc bfc" id="L619" title="All 2 branches covered.">        if (fields == null)</span>
        {
<span class="fc" id="L621">            fields = new PageFields(this);</span>
        }
<span class="fc" id="L623">        return fields;</span>
    }

    /**
     * Returns the attached session if available
     *
     * @return HTTPSession or NULL
     */
    public final HttpSession getSession()
    {
<span class="nc" id="L633">        return session;</span>
    }

    /**
     * Sets this pages session
     *
     * @param session HttpSession or null
     */
    public final void setSession(HttpSession session)
    {
<span class="nc" id="L643">        this.session = session;</span>
<span class="nc" id="L644">    }</span>

    /**
     * Returns the Servlet processing requests
     *
     * @return The JWebSwingServlet
     */
    public JWebSwingServlet getServlet()
    {
<span class="nc" id="L653">        return servlet;</span>
    }

    /**
     * Sets the Servlet to a new Servlet
     *
     * @param servlet The Servlet to set
     */
    public void setServlet(JWebSwingServlet servlet)
    {
<span class="nc" id="L663">        this.servlet = servlet;</span>
<span class="nc" id="L664">    }</span>

    /**
     * Returns the document type that will be rendered with this HTML page real-time
     * &lt;p&gt;
     * @return Document Type
     */
    @Override
    public DocumentType getDocumentType()
    {
<span class="nc" id="L674">        return new DocumentType(getBrowser().getHtmlVersion());</span>
    }

    /**
     * Sets all component in the head and body to tiny
     *
     * @param tiny
     *
     * @return
     */
    @Override
    public Page setTiny(boolean tiny)
    {
<span class="fc" id="L687">        super.setTiny(tiny);</span>
<span class="fc" id="L688">        getHead().setTiny(tiny);</span>
<span class="fc" id="L689">        getBody().setTiny(tiny);</span>
<span class="fc" id="L690">        return this;</span>
    }

    /**
     * Returns the JavaScript render for the body
     *
     * @return
     */
    @Override
    public StringBuilder renderJavascript()
    {
<span class="fc" id="L701">        return getBody().renderJavascript();</span>
    }

    /**
     * Adds a variable into angular
     *
     * @param variableName
     *
     * @return
     */
    @Override
    public Page addAngularVariable(String variableName)
    {
<span class="fc" id="L714">        getAngular().getAngularVariables().add(variableName);</span>
<span class="fc" id="L715">        return this;</span>
    }

    /**
     * Returns the angular object
     *
     * @return
     */
    @Override
    public AngularFeature getAngular()
    {
<span class="fc bfc" id="L726" title="All 2 branches covered.">        if (angular == null)</span>
        {
<span class="fc" id="L728">            angular = new AngularFeature(getBody());</span>
<span class="fc" id="L729">            getBody().addFeature(angular);</span>
        }
<span class="fc" id="L731">        return angular;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>