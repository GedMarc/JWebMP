<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Page.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;JWebSwing&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">za.co.mmagon.jwebswing</a> &gt; <span class="el_source">Page.java</span></div><h1>Page.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2016 ged_m
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package za.co.mmagon.jwebswing;

import com.fasterxml.jackson.annotation.JsonIgnore;
import java.util.*;
import java.util.List;
import net.sf.uadetector.*;
import za.co.mmagon.FileTemplates;
import za.co.mmagon.JWebSwingSiteBinder;
import za.co.mmagon.jwebswing.base.ComponentHierarchyBase;
import za.co.mmagon.jwebswing.base.angular.AngularFeature;
import za.co.mmagon.jwebswing.base.client.InternetExplorerCompatibilityMode;
import za.co.mmagon.jwebswing.base.html.*;
import za.co.mmagon.jwebswing.base.html.attributes.ScriptAttributes;
import za.co.mmagon.jwebswing.base.html.interfaces.children.HeadChildren;
import za.co.mmagon.jwebswing.base.references.CSSReference;
import za.co.mmagon.jwebswing.base.references.JavascriptReference;
import za.co.mmagon.jwebswing.base.servlets.enumarations.RequirementsPriority;
import za.co.mmagon.jwebswing.base.servlets.interfaces.IPage;
import za.co.mmagon.jwebswing.generics.WebReference;

/**
 * Top level of any HTML page.
 * &lt;p&gt;
 * Has only two children, head and body.
 * &lt;p&gt;
 * Sometimes scripts are added right at the end but we try to avoid that as much as possible.
 *
 * @author GedMarc
 * @since 24 Apr 2016
 * @version 2.0
 *
 * Replacement of the old page object
 */
public class Page extends Html implements IPage
{

    private static final long serialVersionUID = 1L;
    /**
     * The options available
     */
    private PageOptions options;
    /**
     * The fields available
     */
    private PageFields fields;
    

    /**
     * The current user agent of the render
     */
    @JsonIgnore
    private transient ReadableUserAgent userAgent;

    /**
     * The angular feature
     */
    private AngularFeature angular;

    /**
     * Cache for all the associated components throughout the life-cycle of the application
     */
    private transient java.util.Map&lt;String, ComponentHierarchyBase&gt; componentCache;

    /**
     * Populates all my components. Excludes this page
     */
    /**
     * @param title             Sets the title of the page
     * @param compatibilityMode Sets the Internet explorer mode to work on
     * @param base              Sets the base tag for the page. Convenience Parameter
     */
    public Page(Title title, InternetExplorerCompatibilityMode compatibilityMode, Base base)
<span class="fc" id="L89">    {</span>
<span class="fc" id="L90">        getPageFields().setTitle(title);</span>
<span class="fc" id="L91">        getPageFields().setCompatibilityMode(compatibilityMode);</span>
<span class="fc" id="L92">        getPageFields().setBase(base);</span>
<span class="fc" id="L93">        setID(&quot;jwPage&quot;);</span>
        //setGenerator(&quot;JWebSwing - https://sourceforge.net/projects/jwebswing/&quot;);
<span class="fc" id="L95">    }</span>

    /**
     * @param title             Sets the title of the page
     * @param compatibilityMode Sets the Internet explorer mode to work on
     */
    public Page(Title title, InternetExplorerCompatibilityMode compatibilityMode)
    {
<span class="nc" id="L103">        this(title, compatibilityMode, null);</span>
<span class="nc" id="L104">    }</span>

    /**
     * @param title Sets the title of the page
     */
    public Page(Title title)
    {
<span class="nc" id="L111">        this(title, null, null);</span>
<span class="nc" id="L112">    }</span>

    /**
     * @param title Sets the title of the page
     */
    public Page(String title)
    {
<span class="nc" id="L119">        this(new Title(title), null, null);</span>
<span class="nc" id="L120">    }</span>

    /**
     * Constructs an empty page object
     */
    public Page()
    {
<span class="fc" id="L127">        this(null, null, null);</span>
<span class="fc" id="L128">    }</span>

    /**
     * Renders all the children to a string builder
     *
     * @return
     */
    @Override
    protected StringBuilder renderChildren()
    {
<span class="fc" id="L138">        StringBuilder pageOutput = new StringBuilder();</span>
<span class="fc" id="L139">        StringBuilder bodyOutput = null;</span>

<span class="fc bfc" id="L141" title="All 2 branches covered.">        if (!isBodyEmpty())</span>
        {
<span class="fc" id="L143">            bodyOutput = new StringBuilder(getBody().toString(1));</span>
        }

<span class="fc bfc" id="L146" title="All 2 branches covered.">        if (!isHeadEmpty())</span>
        {
<span class="fc" id="L148">            pageOutput.append(getNewLine()).append(getCurrentTabIndentString()).append(getHead().toString(1));</span>
        }
<span class="fc bfc" id="L150" title="All 2 branches covered.">        if (bodyOutput != null)</span>
        {
<span class="fc" id="L152">            pageOutput.append(getNewLine()).append(getCurrentTabIndentString()).append(bodyOutput);</span>
        }
<span class="fc" id="L154">        return pageOutput;</span>
    }

    @Override
    public void init()
    {
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">        if (!isInitialized())</span>
        {
<span class="fc" id="L162">            getBody().init();</span>
        }
<span class="fc" id="L164">        super.init();</span>
<span class="fc" id="L165">    }</span>

    /**
     * Configures the page and all its components
     */
    @Override
    public void preConfigure()
    {
<span class="fc bfc" id="L173" title="All 2 branches covered.">        if (!isInitialized())</span>
        {
<span class="fc" id="L175">            init();</span>
        }
<span class="pc bpc" id="L177" title="1 of 2 branches missed.">        if (!isConfigured())</span>
        {
<span class="fc" id="L179">            getBody().init();</span>
<span class="fc" id="L180">            getBody().preConfigure();</span>

<span class="fc" id="L182">            getAngular().preConfigure();</span>

<span class="fc" id="L184">            configurePageHeader();</span>

<span class="fc" id="L186">            addVariablesScriptToPage();</span>

<span class="pc bpc" id="L188" title="1 of 2 branches missed.">            if (!getOptions().isScriptsInHead())</span>
            {
<span class="fc" id="L190">                addScriptsTo(getBody());</span>
            }

<span class="pc bpc" id="L193" title="1 of 2 branches missed.">            if (!getOptions().isScriptsInHead())</span>
            {
<span class="fc" id="L195">                List&lt;Script&gt; allScripts = getDynamicScripts();</span>
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">                allScripts.stream().filter(script -&gt; (script != null)).forEach(getBody()::add);</span>
            }

<span class="fc" id="L199">            getTopShelfScripts().forEach(next -&gt;</span>
            {
<span class="fc" id="L201">                getHead().add((HeadChildren) next);</span>
<span class="fc" id="L202">            });</span>

<span class="fc" id="L204">            ArrayList&lt;ComponentHierarchyBase&gt; requirements = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L206" title="All 2 branches covered.">            for (RequirementsPriority priority : RequirementsPriority.values())</span>
            {
<span class="fc" id="L208">                getPriorityRequirements(priority, requirements, true, false).stream().forEach((comp) -&gt;</span>
                {
<span class="fc" id="L210">                    getHead().getChildren().add(comp);</span>
<span class="fc" id="L211">                });</span>
            }
<span class="fc" id="L213">            getHead().add((HeadChildren) getCssStyle());</span>

<span class="fc" id="L215">            buildComponentHierarchy();</span>
        }
<span class="fc" id="L217">        super.preConfigure();</span>
<span class="fc" id="L218">    }</span>

    /**
     * Returns the component with only it's methods
     *
     * @return
     */
    public IPage asMe()
    {
<span class="nc" id="L227">        return this;</span>
    }

    /**
     * Returns this pages current component cache
     *
     * @return
     */
    @Override
    public java.util.Map&lt;String, ComponentHierarchyBase&gt; getComponentCache()
    {
<span class="fc bfc" id="L238" title="All 2 branches covered.">        if (componentCache == null)</span>
        {
<span class="fc" id="L240">            componentCache = new HashMap&lt;&gt;();</span>
        }
<span class="fc" id="L242">        return componentCache;</span>
    }

    /**
     * Returns all the components currently associated with this page
     *
     * @return
     */
    @Override
    public List&lt;ComponentHierarchyBase&gt; getAllComponents()
    {
<span class="nc" id="L253">        return (List&lt;ComponentHierarchyBase&gt;) getComponentCache().values();</span>
    }

    /**
     * Builds the component hierarchy from scratch
     */
    public void buildComponentHierarchy()
    {
        //getComponentCache().clear();
<span class="fc" id="L262">        getComponentCache().put(getBody().getID(), getBody());</span>
<span class="fc" id="L263">        buildComponentHierarchy(getBody(), getComponentCache());</span>
<span class="fc" id="L264">    }</span>

    /**
     * Builds up or adds components to the page
     *
     * @param startingPoint The starting component to update with
     * @param addToMap      The map to add to
     */
    public void buildComponentHierarchy(ComponentHierarchyBase startingPoint, java.util.Map&lt;String, ComponentHierarchyBase&gt; addToMap)
    {
<span class="pc bpc" id="L274" title="1 of 2 branches missed.">        startingPoint.getChildren().stream().filter(child -&gt; !(child == null)).map(child</span>
                -&gt;
        {
<span class="fc" id="L277">            ComponentHierarchyBase c = (ComponentHierarchyBase) child;</span>
<span class="fc" id="L278">            addToMap.put(c.getID(), c);</span>
<span class="fc" id="L279">            return child;</span>
<span class="fc" id="L280">        }).forEach(child</span>
                -&gt;
        {
<span class="fc" id="L283">            ComponentHierarchyBase c = (ComponentHierarchyBase) child;</span>
<span class="pc bpc" id="L284" title="1 of 2 branches missed.">            if (child != null)</span>
            {
<span class="fc" id="L286">                buildComponentHierarchy(c, addToMap);</span>
            }
<span class="fc" id="L288">        });</span>
<span class="fc" id="L289">    }</span>

    /**
     * Sets the current component cache
     *
     * @param componentCache
     */
    public void setComponentCache(HashMap&lt;String, ComponentHierarchyBase&gt; componentCache)
    {
<span class="nc" id="L298">        this.componentCache = componentCache;</span>
<span class="nc" id="L299">    }</span>

    /**
     * Returns the style object. If dynamic rendering is enabled it will point to the Servlet.
     *
     * @return
     */
    public ComponentHierarchyBase getCssStyle()
    {
<span class="fc" id="L308">        StringBuilder css = getBody().renderCss(0);</span>
<span class="fc bfc" id="L309" title="All 2 branches covered.">        if (!css.toString().isEmpty())</span>
        {
<span class="fc bfc" id="L311" title="All 2 branches covered.">            if (getOptions().isDynamicRender())</span>
            {
<span class="fc" id="L313">                CSSLink renderedCSS = new CSSLink(JWebSwingSiteBinder.getCSSLocation().replaceAll(&quot;/&quot;, &quot;&quot;));</span>
<span class="fc" id="L314">                return renderedCSS;</span>
            }
            else
            {
<span class="pc bpc" id="L318" title="1 of 2 branches missed.">                if (css.length() &gt; 0)</span>
                {
<span class="fc" id="L320">                    Style style = new Style();</span>
<span class="fc" id="L321">                    style.setText(css);</span>
<span class="fc" id="L322">                    return style;</span>
                }
            }
        }
<span class="fc" id="L326">        return null;</span>
    }

    /**
     * Returns the top shelf script and css references
     *
     * @return
     */
    private List&lt;ComponentHierarchyBase&gt; getTopShelfScripts()
    {
        List&lt;ComponentHierarchyBase&gt; arr;
<span class="fc" id="L337">        arr = getPriorityRequirements(RequirementsPriority.Top_Shelf, new ArrayList&lt;&gt;(), true, true);</span>
<span class="fc" id="L338">        return arr;</span>
    }

    /**
     * Returns the script reference
     *
     * @return ArrayList of type script
     */
    private List&lt;Script&gt; getDynamicScripts()
    {
<span class="fc" id="L348">        ArrayList&lt;Script&gt; allScripts = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L350" title="All 2 branches covered.">        if (getOptions().isAngularEnabled())</span>
        {
<span class="pc bpc" id="L352" title="1 of 2 branches missed.">            if (getOptions().isDynamicRender())</span>
            {
<span class="nc" id="L354">                Script dynamicScript = new Script();</span>
<span class="nc" id="L355">                dynamicScript.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="nc" id="L356">                dynamicScript.addAttribute(ScriptAttributes.Src, JWebSwingSiteBinder.getAngularScriptLocation().replaceAll(&quot;/&quot;, &quot;&quot;));</span>
                //dynamicScript.setTiny(true);
                //dynamicScript.setText(&quot;$.ajax({cache:false,async:false,dataType:'script',url:'as'}).fail(function(){alert('session lost'); });&quot;);
<span class="nc" id="L359">                allScripts.add(dynamicScript);</span>
<span class="nc" id="L360">            }</span>
            else
            {
<span class="fc" id="L363">                getAngular().configureTemplateVariables();</span>
<span class="fc" id="L364">                StringBuilder js = FileTemplates.renderTemplateScripts(&quot;jwangular&quot;);</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">                if (!js.toString().trim().isEmpty())</span>
                {
<span class="fc" id="L367">                    Script s = new Script();</span>
<span class="fc" id="L368">                    s.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="fc" id="L369">                    s.setText(js);</span>
<span class="fc" id="L370">                    allScripts.add(s);</span>
                }
            }
        }

<span class="fc bfc" id="L375" title="All 2 branches covered.">        if (getOptions().isDynamicRender())</span>
        {
<span class="fc" id="L377">            StringBuilder js = renderJavascript();</span>
<span class="fc bfc" id="L378" title="All 2 branches covered.">            if (!js.toString().trim().isEmpty())</span>
            {
<span class="fc" id="L380">                Script dynamicScript = new Script();</span>
<span class="fc" id="L381">                dynamicScript.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="fc" id="L382">                dynamicScript.addAttribute(ScriptAttributes.Src, JWebSwingSiteBinder.getJavaScriptLocation().replaceAll(&quot;/&quot;, &quot;&quot;));</span>
                //dynamicScript.setTiny(true);
                //dynamicScript.setText(&quot;$.ajax({cache:false,dataType:'script',url:'js'}).fail(function(){alert('session lost'); });&quot;);
<span class="fc" id="L385">                allScripts.add(dynamicScript);</span>
            }
<span class="fc" id="L387">        }</span>
        else
        {
<span class="fc" id="L390">            StringBuilder js = renderJavascript();</span>
<span class="fc bfc" id="L391" title="All 2 branches covered.">            if (!js.toString().trim().isEmpty())</span>
            {
<span class="fc" id="L393">                Script s = new Script();</span>
<span class="fc" id="L394">                s.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="fc" id="L395">                s.setText(js);</span>
<span class="fc" id="L396">                allScripts.add(s);</span>
            }
        }

<span class="fc" id="L400">        return allScripts;</span>
    }

    /**
     * Builds up the Header Tag
     */
    private void configurePageHeader()
    {
<span class="fc bfc" id="L408" title="All 2 branches covered.">        if (getPageFields().getTitle() != null)</span>
        {
<span class="fc" id="L410">            getHead().add(getPageFields().getTitle());</span>
        }
<span class="fc bfc" id="L412" title="All 2 branches covered.">        if (getPageFields().getBase() != null)</span>
        {
<span class="fc" id="L414">            getHead().add(getPageFields().getBase());</span>
        }
<span class="fc" id="L416">        getHead().add(getPageFields().getHttpEquivMeta());</span>
<span class="fc" id="L417">        getHead().add(getPageFields().getCacheControl());</span>
<span class="fc" id="L418">        getHead().add(getPageFields().getAuthor());</span>
<span class="fc" id="L419">        getHead().add(getPageFields().getApplicationName());</span>
<span class="fc" id="L420">        getHead().add(getPageFields().getGenerator());</span>
<span class="fc" id="L421">        getHead().add(getPageFields().getDescription());</span>
<span class="fc" id="L422">        getHead().add(getPageFields().getKeywords());</span>
<span class="fc" id="L423">        getHead().add(getPageFields().getFavIconLink());</span>

<span class="pc bpc" id="L425" title="1 of 2 branches missed.">        if (getOptions().isScriptsInHead())</span>
        {
<span class="nc" id="L427">            addScriptsTo(getHead());</span>
        }

<span class="pc bpc" id="L430" title="1 of 2 branches missed.">        if (getOptions().isScriptsInHead())</span>
        {
<span class="nc" id="L432">            List&lt;Script&gt; allScripts = getDynamicScripts();</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">            allScripts.stream().filter(script -&gt; (script != null)).forEach(getHead()::add);</span>
        }

<span class="fc" id="L436">        getHead().getChildren().stream().forEach((headObject)</span>
                -&gt;
        {
<span class="fc" id="L439">            headObject.init();</span>
<span class="fc" id="L440">            headObject.preConfigure();</span>
<span class="fc" id="L441">        });</span>
<span class="fc" id="L442">    }</span>

    /**
     * Adds the variables in the application to the collection
     */
    private void addVariablesScriptToPage()
    {
<span class="fc" id="L449">        StringBuilder variablesScriptBuilder = new StringBuilder();</span>
<span class="fc bfc" id="L450" title="All 2 branches covered.">        for (Iterator it = getBody().getVariablesAll().iterator(); it.hasNext();)</span>
        {
<span class="fc" id="L452">            String var = (String) it.next();</span>
<span class="fc" id="L453">            variablesScriptBuilder.append(&quot;var &quot;).append(var).append(&quot;;&quot;);</span>
<span class="fc" id="L454">        }</span>
<span class="fc bfc" id="L455" title="All 2 branches covered.">        if (variablesScriptBuilder.length() &gt; 0)</span>
        {
<span class="fc" id="L457">            Script variablesScript = new Script();</span>
<span class="fc" id="L458">            variablesScript.setID(&quot;variables&quot;);</span>
<span class="fc" id="L459">            variablesScript.setNewLineForRawText(true);</span>
<span class="fc" id="L460">            variablesScript.addAttribute(ScriptAttributes.Type, &quot;text/javascript&quot;);</span>
<span class="fc" id="L461">            variablesScript.setText(variablesScriptBuilder.toString());</span>
<span class="pc bpc" id="L462" title="1 of 2 branches missed.">            if (!getHead().getChildren().contains(variablesScript))</span>
            {
<span class="fc" id="L464">                getHead().add(variablesScript);</span>
            }
        }
<span class="fc" id="L467">    }</span>

    private void addScriptsTo(ComponentHierarchyBase component)
    {
<span class="fc" id="L471">        List&lt;ComponentHierarchyBase&gt; requirements = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L473">        List&lt;RequirementsPriority&gt; arrs = new ArrayList&lt;&gt;(Arrays.asList(RequirementsPriority.values()));</span>
        //render JS only
<span class="fc bfc" id="L475" title="All 2 branches covered.">        arrs.stream().filter(a -&gt; a != RequirementsPriority.Top_Shelf).map(priority -&gt;</span>
        {
<span class="fc bfc" id="L477" title="All 2 branches covered.">            if (!getPriorityRequirements(priority, requirements, true, false).isEmpty())</span>
            {
                //getBody().add(new Comment(&quot;Priority [&quot; + priority + &quot;] Values&quot;));
            }
<span class="fc" id="L481">            return priority;</span>
<span class="fc" id="L482">        }).forEachOrdered(priority -&gt;</span>
        {
<span class="fc" id="L484">            getPriorityRequirements(priority, requirements, false, true).stream().forEach(comp</span>
                    -&gt;
            {
<span class="fc" id="L487">                component.add(comp);</span>
<span class="fc" id="L488">            });</span>
<span class="fc" id="L489">        });</span>
<span class="fc" id="L490">    }</span>

    /**
     * Adds all the stuff for a given priority
     *
     * @param css        CSS
     * @param input      the hierarchy to read from
     * @param priority   the priority
     * @param javascript to return JavaScript or not
     */
    private List&lt;ComponentHierarchyBase&gt; getPriorityRequirements(RequirementsPriority priority, List&lt;ComponentHierarchyBase&gt; input, boolean css, boolean javascript)
    {
<span class="fc" id="L502">        List&lt;ComponentHierarchyBase&gt; requirements = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L503" title="All 2 branches covered.">        if (css)</span>
        {
<span class="pc bpc" id="L505" title="2 of 4 branches missed.">            getAllCssLinks(priority).stream().filter(cssLink -&gt; (!input.contains(cssLink) &amp;&amp; !requirements.contains(cssLink))).forEach(cssLink</span>
                    -&gt;
            {
<span class="fc" id="L508">                requirements.add(cssLink);</span>
<span class="fc" id="L509">            });</span>
        }
<span class="fc bfc" id="L511" title="All 2 branches covered.">        if (javascript)</span>
        {
<span class="pc bpc" id="L513" title="2 of 4 branches missed.">            getAllScripts(priority).stream().filter(script -&gt; (!input.contains(script) &amp;&amp; !requirements.contains(script))).forEach(script</span>
                    -&gt;
            {
<span class="fc" id="L516">                requirements.add(script);</span>
<span class="fc" id="L517">            });</span>
        }

<span class="fc" id="L520">        return requirements;</span>
    }

    /**
     * Gets all the links for all the bodies components
     *
     * @param priority
     *
     * @return
     */
    private List&lt;CSSLink&gt; getAllCssLinks(RequirementsPriority priority)
    {
<span class="fc" id="L532">        List&lt;CSSReference&gt; allReferences = getBody().getCssReferencesAll(priority);</span>
<span class="fc" id="L533">        allReferences.sort(WebReference.getDummyReference());</span>
<span class="fc" id="L534">        ArrayList&lt;CSSLink&gt; allLinks = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L535">        allReferences.stream().map(ref -&gt; new CSSLink(ref)).forEach(allLinks::add);</span>
<span class="fc" id="L536">        return allLinks;</span>
    }

    /**
     * Gets all the scripts for all the body components
     *
     * @param priority
     *
     * @return
     */
    private List&lt;Script&gt; getAllScripts(RequirementsPriority priority)
    {
<span class="fc" id="L548">        List&lt;JavascriptReference&gt; allJavascripts = getBody().getJavascriptReferencesAll(priority);</span>
<span class="fc" id="L549">        allJavascripts.sort(WebReference.getDummyReference());</span>
<span class="fc" id="L550">        ArrayList&lt;Script&gt; allScripts = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L551">        allJavascripts.stream().map(js -&gt; new Script(js)).forEach(s</span>
                -&gt;
        {
<span class="fc" id="L554">            s.setNewLineForClosingTag(false);</span>
<span class="fc" id="L555">            allScripts.add(s);</span>
<span class="fc" id="L556">        });</span>
<span class="fc" id="L557">        return allScripts;</span>
    }

    /**
     * Returns if the head object is empty
     *
     * @return
     */
    private boolean isHeadEmpty()
    {
<span class="fc" id="L567">        return getHead().getChildren().isEmpty();</span>
    }

    /**
     * Returns if the body object is empty
     *
     * @return
     */
    private boolean isBodyEmpty()
    {
<span class="fc" id="L577">        return getBody().getChildren().isEmpty();</span>
    }

    /**
     * Returns a readable user agent, or null if just a basic render
     *
     * @return
     */
    public ReadableUserAgent getUserAgent()
    {
<span class="nc bnc" id="L587" title="All 2 branches missed.">        if (userAgent == null)</span>
        {
<span class="nc" id="L589">            userAgent = new UserAgent(DeviceCategory.EMPTY, UserAgentFamily.FIREFOX, &quot;&quot;, &quot;&quot;, OperatingSystem.EMPTY, &quot;&quot;, &quot;&quot;, UserAgentType.BROWSER, &quot;&quot;, &quot;&quot;, VersionNumber.UNKNOWN);</span>
        }
<span class="nc" id="L591">        return userAgent;</span>
    }

    /**
     * Sets the userAgent
     *
     * @param userAgent
     */
    public void setUserAgent(ReadableUserAgent userAgent)
    {
<span class="nc" id="L601">        this.userAgent = userAgent;</span>
<span class="nc" id="L602">    }</span>

    /**
     * Returns all the dynamic options for a page
     *
     * @return
     */
    @Override
    public final PageOptions getOptions()
    {
<span class="fc bfc" id="L612" title="All 2 branches covered.">        if (options == null)</span>
        {
<span class="fc" id="L614">            options = new PageOptions(this);</span>
        }
<span class="fc" id="L616">        return options;</span>
    }

    /**
     * Returns the fields available for entry on this page
     *
     * @return
     */
    @Override
    public final PageFields getPageFields()
    {
<span class="fc bfc" id="L627" title="All 2 branches covered.">        if (fields == null)</span>
        {
<span class="fc" id="L629">            fields = new PageFields(this);</span>
        }
<span class="fc" id="L631">        return fields;</span>
    }

    /**
     * Returns the document type that will be rendered with this HTML page real-time
     * &lt;p&gt;
     * @return Document Type
     */
    @Override
    public DocumentType getDocumentType()
    {
<span class="nc" id="L642">        return new DocumentType(getBrowser().getHtmlVersion());</span>
    }

    /**
     * Sets all component in the head and body to tiny
     *
     * @param tiny
     *
     * @return
     */
    @Override
    public Page setTiny(boolean tiny)
    {
<span class="fc" id="L655">        super.setTiny(tiny);</span>
<span class="fc" id="L656">        getHead().setTiny(tiny);</span>
<span class="fc" id="L657">        getBody().setTiny(tiny);</span>
<span class="fc" id="L658">        return this;</span>
    }

    /**
     * Returns the JavaScript render for the body
     *
     * @return
     */
    @Override
    public StringBuilder renderJavascript()
    {
<span class="fc" id="L669">        return getBody().renderJavascript();</span>
    }

    /**
     * Adds a variable into angular
     *
     * @param variableName
     *
     * @return
     */
    @Override
    public Page addAngularVariable(String variableName)
    {
<span class="fc" id="L682">        getAngular().getAngularVariables().add(variableName);</span>
<span class="fc" id="L683">        return this;</span>
    }

    /**
     * Returns the angular object
     *
     * @return
     */
    @Override
    public AngularFeature getAngular()
    {
<span class="fc bfc" id="L694" title="All 2 branches covered.">        if (angular == null)</span>
        {
<span class="fc" id="L696">            angular = new AngularFeature(getBody());</span>
<span class="fc" id="L697">            getBody().addFeature(angular);</span>
        }
<span class="fc" id="L699">        return angular;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>