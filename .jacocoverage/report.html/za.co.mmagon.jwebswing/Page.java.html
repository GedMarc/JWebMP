<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Page.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;JWebSwing&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">za.co.mmagon.jwebswing</a> &gt; <span class="el_source">Page.java</span></div><h1>Page.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2016 ged_m
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package za.co.mmagon.jwebswing;

import com.fasterxml.jackson.annotation.JsonIgnore;
import java.util.*;
import java.util.List;
import net.sf.uadetector.*;
import za.co.mmagon.JWebSwingSiteBinder;
import za.co.mmagon.jwebswing.base.ComponentHierarchyBase;
import za.co.mmagon.jwebswing.base.angular.AngularFeature;
import za.co.mmagon.jwebswing.base.client.InternetExplorerCompatibilityMode;
import za.co.mmagon.jwebswing.base.html.*;
import za.co.mmagon.jwebswing.base.html.attributes.ScriptAttributes;
import za.co.mmagon.jwebswing.base.html.interfaces.children.HeadChildren;
import za.co.mmagon.jwebswing.base.references.CSSReference;
import za.co.mmagon.jwebswing.base.references.JavascriptReference;
import za.co.mmagon.jwebswing.base.servlets.enumarations.RequirementsPriority;
import za.co.mmagon.jwebswing.base.servlets.interfaces.IPage;
import za.co.mmagon.jwebswing.generics.WebReference;

/**
 * Top level of any HTML page.
 * &lt;p&gt;
 * Has only two children, head and body.
 * &lt;p&gt;
 * Sometimes scripts are added right at the end but we try to avoid that as much as possible.
 *
 * @author GedMarc
 * @since 24 Apr 2016
 * @version 2.0
 *
 * Replacement of the old page object
 */
public class Page extends Html implements IPage
{

    private static final long serialVersionUID = 1L;
    /**
     * The options available
     */
    private PageOptions options;
    /**
     * The fields available
     */
    private PageFields fields;

    /**
     * The current user agent of the render
     */
    @JsonIgnore
    private transient ReadableUserAgent userAgent;

    /**
     * The angular feature
     */
    private AngularFeature angular;

    /**
     * Cache for all the associated components throughout the life-cycle of the application
     */
    private transient HashMap&lt;String, ComponentHierarchyBase&gt; componentCache;

    /**
     * Populates all my components. Excludes this page
     */
    /**
     * @param title             Sets the title of the page
     * @param compatibilityMode Sets the Internet explorer mode to work on
     * @param base              Sets the base tag for the page. Convenience Parameter
     */
    public Page(Title title, InternetExplorerCompatibilityMode compatibilityMode, Base base)
<span class="fc" id="L87">    {</span>
<span class="fc" id="L88">        getPageFields().setTitle(title);</span>
<span class="fc" id="L89">        getPageFields().setCompatibilityMode(compatibilityMode);</span>
<span class="fc" id="L90">        getPageFields().setBase(base);</span>
<span class="fc" id="L91">        setID(&quot;jwPage&quot;);</span>
        //setGenerator(&quot;JWebSwing - https://sourceforge.net/projects/jwebswing/&quot;);
<span class="fc" id="L93">    }</span>

    /**
     * @param title             Sets the title of the page
     * @param compatibilityMode Sets the Internet explorer mode to work on
     */
    public Page(Title title, InternetExplorerCompatibilityMode compatibilityMode)
    {
<span class="nc" id="L101">        this(title, compatibilityMode, null);</span>
<span class="nc" id="L102">    }</span>

    /**
     * @param title Sets the title of the page
     */
    public Page(Title title)
    {
<span class="nc" id="L109">        this(title, null, null);</span>
<span class="nc" id="L110">    }</span>

    /**
     * @param title Sets the title of the page
     */
    public Page(String title)
    {
<span class="nc" id="L117">        this(new Title(title), null, null);</span>
<span class="nc" id="L118">    }</span>

    /**
     * Constructs an empty page object
     */
    public Page()
    {
<span class="fc" id="L125">        this(null, null, null);</span>
<span class="fc" id="L126">    }</span>

    /**
     * Renders all the children to a string builder
     *
     * @return
     */
    @Override
    protected StringBuilder renderChildren()
    {
<span class="fc" id="L136">        StringBuilder pageOutput = new StringBuilder();</span>
<span class="fc" id="L137">        StringBuilder bodyOutput = null;</span>

<span class="fc bfc" id="L139" title="All 2 branches covered.">        if (!isBodyEmpty())</span>
        {
<span class="fc" id="L141">            bodyOutput = new StringBuilder(getBody().toString(1));</span>
        }
        
<span class="fc bfc" id="L144" title="All 2 branches covered.">        if (!isHeadEmpty())</span>
        {
<span class="fc" id="L146">            pageOutput.append(getNewLine()).append(getCurrentTabIndentString()).append(getHead().toString(1));</span>
        }
<span class="fc bfc" id="L148" title="All 2 branches covered.">        if (bodyOutput != null)</span>
        {
<span class="fc" id="L150">            pageOutput.append(getNewLine()).append(getCurrentTabIndentString()).append(bodyOutput);</span>
        }
<span class="fc" id="L152">        return pageOutput;</span>
    }

    @Override
    public void init()
    {
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">        if (!isInitialized())</span>
        {
<span class="fc" id="L160">            getBody().init();</span>
        }
<span class="fc" id="L162">        super.init();</span>
<span class="fc" id="L163">    }</span>

    /**
     * Configures the page and all its components
     */
    @Override
    public void preConfigure()
    {
<span class="fc bfc" id="L171" title="All 2 branches covered.">        if (!isInitialized())</span>
        {
<span class="fc" id="L173">            init();</span>
        }
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">        if (!isConfigured())</span>
        {
<span class="fc" id="L177">            getBody().init();</span>
<span class="fc" id="L178">            getBody().preConfigure();</span>
<span class="fc" id="L179">            getAngular().preConfigure();</span>

<span class="fc" id="L181">            configurePageHeader();</span>

<span class="fc" id="L183">            addVariablesScriptToPage();</span>

<span class="fc" id="L185">            addScriptsToBody();</span>

<span class="fc" id="L187">            List&lt;Script&gt; allScripts = getDynamicScripts();</span>

<span class="pc bpc" id="L189" title="1 of 2 branches missed.">            allScripts.stream().filter(script -&gt; (script != null)).forEach(getBody()::add);</span>

<span class="fc" id="L191">            getTopShelfScripts().forEach(next -&gt;</span>
            {
<span class="fc" id="L193">                getHead().add((HeadChildren) next);</span>
<span class="fc" id="L194">            });</span>

<span class="fc" id="L196">            ArrayList&lt;ComponentHierarchyBase&gt; requirements = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L198" title="All 2 branches covered.">            for (RequirementsPriority priority : RequirementsPriority.values())</span>
            {
<span class="fc" id="L200">                getPriorityRequirements(priority, requirements, true, false).stream().forEach((comp) -&gt;</span>
                {
<span class="fc" id="L202">                    getHead().getChildren().add(comp);</span>
<span class="fc" id="L203">                });</span>
            }
<span class="fc" id="L205">            getHead().add((HeadChildren) getCssStyle());</span>

<span class="fc" id="L207">            buildComponentHierarchy();</span>
        }
<span class="fc" id="L209">        super.preConfigure();</span>
<span class="fc" id="L210">    }</span>

    /**
     * Returns the component with only it's methods
     *
     * @return
     */
    public IPage asMe()
    {
<span class="nc" id="L219">        return this;</span>
    }

    /**
     * Returns this pages current component cache
     *
     * @return
     */
    @Override
    public java.util.Map&lt;String, ComponentHierarchyBase&gt; getComponentCache()
    {
<span class="fc bfc" id="L230" title="All 2 branches covered.">        if (componentCache == null)</span>
        {
<span class="fc" id="L232">            componentCache = new HashMap&lt;&gt;();</span>
        }
<span class="fc" id="L234">        return componentCache;</span>
    }

    /**
     * Returns all the components currently associated with this page
     *
     * @return
     */
    @Override
    public List&lt;ComponentHierarchyBase&gt; getAllComponents()
    {
<span class="nc" id="L245">        return (List&lt;ComponentHierarchyBase&gt;) getComponentCache().values();</span>
    }

    /**
     * Builds the component hierarchy from scratch
     */
    public void buildComponentHierarchy()
    {
        //getComponentCache().clear();
<span class="fc" id="L254">        getComponentCache().put(getBody().getID(), getBody());</span>
<span class="fc" id="L255">        buildComponentHierarchy(getBody(), getComponentCache());</span>
<span class="fc" id="L256">    }</span>

    /**
     * Builds up or adds components to the page
     *
     * @param startingPoint The starting component to update with
     * @param addToMap      The map to add to
     */
    public void buildComponentHierarchy(ComponentHierarchyBase startingPoint, java.util.Map&lt;String, ComponentHierarchyBase&gt; addToMap)
    {
<span class="pc bpc" id="L266" title="1 of 2 branches missed.">        startingPoint.getChildren().stream().filter(child -&gt; !(child == null)).map(child</span>
                -&gt;
        {
<span class="fc" id="L269">            ComponentHierarchyBase c = (ComponentHierarchyBase) child;</span>
<span class="fc" id="L270">            addToMap.put(c.getID(), c);</span>
<span class="fc" id="L271">            return child;</span>
<span class="fc" id="L272">        }).forEach(child</span>
                -&gt;
        {
<span class="fc" id="L275">            ComponentHierarchyBase c = (ComponentHierarchyBase) child;</span>
<span class="pc bpc" id="L276" title="1 of 2 branches missed.">            if (child != null)</span>
            {
<span class="fc" id="L278">                buildComponentHierarchy(c, addToMap);</span>
            }
<span class="fc" id="L280">        });</span>
<span class="fc" id="L281">    }</span>

    /**
     * Sets the current component cache
     *
     * @param componentCache
     */
    public void setComponentCache(HashMap&lt;String, ComponentHierarchyBase&gt; componentCache)
    {
<span class="nc" id="L290">        this.componentCache = componentCache;</span>
<span class="nc" id="L291">    }</span>

    /**
     * Returns the style object. If dynamic rendering is enabled it will point to the Servlet.
     *
     * @return
     */
    public ComponentHierarchyBase getCssStyle()
    {
<span class="fc" id="L300">        StringBuilder css = getBody().renderCss(0);</span>
<span class="fc bfc" id="L301" title="All 2 branches covered.">        if (!css.toString().isEmpty())</span>
        {
<span class="fc bfc" id="L303" title="All 2 branches covered.">            if (getOptions().isDynamicRender())</span>
            {
<span class="fc" id="L305">                CSSLink renderedCSS = new CSSLink(JWebSwingSiteBinder.getCSSLocation().replaceAll(&quot;/&quot;, &quot;&quot;));</span>
<span class="fc" id="L306">                return renderedCSS;</span>
            }
            else
            {
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">                if (css.length() &gt; 0)</span>
                {
<span class="fc" id="L312">                    Style style = new Style();</span>
<span class="fc" id="L313">                    style.setText(css);</span>
<span class="fc" id="L314">                    return style;</span>
                }
            }
        }
<span class="fc" id="L318">        return null;</span>
    }

    /**
     * Returns the top shelf script and css references
     *
     * @return
     */
    private List&lt;ComponentHierarchyBase&gt; getTopShelfScripts()
    {
        List&lt;ComponentHierarchyBase&gt; arr;
<span class="fc" id="L329">        arr = getPriorityRequirements(RequirementsPriority.Top_Shelf, new ArrayList&lt;&gt;(), true, true);</span>
<span class="fc" id="L330">        return arr;</span>
    }

    /**
     * Returns the script reference
     *
     * @return ArrayList of type script
     */
    private List&lt;Script&gt; getDynamicScripts()
    {
<span class="fc" id="L340">        ArrayList&lt;Script&gt; allScripts = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L342" title="All 2 branches covered.">        if (getOptions().isAngularEnabled())</span>
        {
<span class="pc bpc" id="L344" title="1 of 2 branches missed.">            if (getOptions().isDynamicRender())</span>
            {
<span class="nc" id="L346">                Script dynamicScript = new Script();</span>
<span class="nc" id="L347">                dynamicScript.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="nc" id="L348">                dynamicScript.addAttribute(ScriptAttributes.Src,  JWebSwingSiteBinder.getAngularScriptLocation().replaceAll(&quot;/&quot;, &quot;&quot;));</span>
                //dynamicScript.setTiny(true);
                //dynamicScript.setText(&quot;$.ajax({cache:false,async:false,dataType:'script',url:'as'}).fail(function(){alert('session lost'); });&quot;);
<span class="nc" id="L351">                allScripts.add(dynamicScript);</span>
<span class="nc" id="L352">            }</span>
            else
            {
<span class="fc" id="L355">                StringBuilder js = getAngular().renderTemplateScripts(&quot;jwangular&quot;);// getBody().renderJavascriptAll();</span>
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">                if (!js.toString().trim().isEmpty())</span>
                {
<span class="fc" id="L358">                    Script s = new Script();</span>
<span class="fc" id="L359">                    s.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="fc" id="L360">                    s.setText(js);</span>
<span class="fc" id="L361">                    allScripts.add(s);</span>
                }
            }
        }

<span class="fc bfc" id="L366" title="All 2 branches covered.">        if (getOptions().isDynamicRender())</span>
        {
<span class="fc" id="L368">            StringBuilder js = renderJavascript();</span>
<span class="fc bfc" id="L369" title="All 2 branches covered.">            if (!js.toString().trim().isEmpty())</span>
            {
<span class="fc" id="L371">                Script dynamicScript = new Script();</span>
<span class="fc" id="L372">                dynamicScript.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="fc" id="L373">                dynamicScript.addAttribute(ScriptAttributes.Src, JWebSwingSiteBinder.getJavaScriptLocation().replaceAll(&quot;/&quot;, &quot;&quot;));</span>
                //dynamicScript.setTiny(true);
                //dynamicScript.setText(&quot;$.ajax({cache:false,dataType:'script',url:'js'}).fail(function(){alert('session lost'); });&quot;);
<span class="fc" id="L376">                allScripts.add(dynamicScript);</span>
            }
<span class="fc" id="L378">        }</span>
        else
        {
<span class="fc" id="L381">            StringBuilder js = renderJavascript();</span>
<span class="fc bfc" id="L382" title="All 2 branches covered.">            if (!js.toString().trim().isEmpty())</span>
            {
<span class="fc" id="L384">                Script s = new Script();</span>
<span class="fc" id="L385">                s.addAttribute(ScriptAttributes.Type, &quot;application/javascript&quot;);</span>
<span class="fc" id="L386">                s.setText(js);</span>
<span class="fc" id="L387">                allScripts.add(s);</span>
            }
        }

<span class="fc" id="L391">        return allScripts;</span>
    }

    /**
     * Builds up the Header Tag
     */
    private void configurePageHeader()
    {
<span class="fc bfc" id="L399" title="All 2 branches covered.">        if (getPageFields().getTitle() != null)</span>
        {
<span class="fc" id="L401">            getHead().add(getPageFields().getTitle());</span>
        }
<span class="fc bfc" id="L403" title="All 2 branches covered.">        if (getPageFields().getBase() != null)</span>
        {
<span class="fc" id="L405">            getHead().add(getPageFields().getBase());</span>
        }
<span class="fc" id="L407">        getHead().add(getPageFields().getHttpEquivMeta());</span>
<span class="fc" id="L408">        getHead().add(getPageFields().getCacheControl());</span>
<span class="fc" id="L409">        getHead().add(getPageFields().getAuthor());</span>
<span class="fc" id="L410">        getHead().add(getPageFields().getApplicationName());</span>
<span class="fc" id="L411">        getHead().add(getPageFields().getGenerator());</span>
<span class="fc" id="L412">        getHead().add(getPageFields().getDescription());</span>
<span class="fc" id="L413">        getHead().add(getPageFields().getKeywords());</span>
<span class="fc" id="L414">        getHead().add(getPageFields().getFavIconLink());</span>

<span class="fc" id="L416">        getHead().getChildren().stream().forEach((headObject)</span>
                -&gt;
        {
<span class="fc" id="L419">            headObject.init();</span>
<span class="fc" id="L420">            headObject.preConfigure();</span>
<span class="fc" id="L421">        });</span>
<span class="fc" id="L422">    }</span>

    /**
     * Adds the variables in the application to the collection
     */
    private void addVariablesScriptToPage()
    {
<span class="fc" id="L429">        StringBuilder variablesScriptBuilder = new StringBuilder();</span>
<span class="fc bfc" id="L430" title="All 2 branches covered.">        for (Iterator it = getBody().getVariablesAll().iterator(); it.hasNext();)</span>
        {
<span class="fc" id="L432">            String var = (String) it.next();</span>
<span class="fc" id="L433">            variablesScriptBuilder.append(&quot;var &quot;).append(var).append(&quot;;&quot;);</span>
<span class="fc" id="L434">        }</span>
<span class="fc bfc" id="L435" title="All 2 branches covered.">        if (variablesScriptBuilder.length() &gt; 0)</span>
        {
<span class="fc" id="L437">            Script variablesScript = new Script();</span>
<span class="fc" id="L438">            variablesScript.setID(&quot;variables&quot;);</span>
<span class="fc" id="L439">            variablesScript.setNewLineForRawText(true);</span>
<span class="fc" id="L440">            variablesScript.addAttribute(ScriptAttributes.Type, &quot;text/javascript&quot;);</span>
<span class="fc" id="L441">            variablesScript.setText(variablesScriptBuilder.toString());</span>
<span class="pc bpc" id="L442" title="1 of 2 branches missed.">            if (!getHead().getChildren().contains(variablesScript))</span>
            {
<span class="fc" id="L444">                getHead().add(variablesScript);</span>
            }
        }
<span class="fc" id="L447">    }</span>

    private void addScriptsToBody()
    {
<span class="fc" id="L451">        List&lt;ComponentHierarchyBase&gt; requirements = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L453">        List&lt;RequirementsPriority&gt; arrs = new ArrayList&lt;&gt;(Arrays.asList(RequirementsPriority.values()));</span>
        //render JS only
<span class="fc bfc" id="L455" title="All 2 branches covered.">        arrs.stream().filter(a -&gt; a != RequirementsPriority.Top_Shelf).map(priority -&gt;</span>
        {
<span class="fc bfc" id="L457" title="All 2 branches covered.">            if (!getPriorityRequirements(priority, requirements, true, false).isEmpty())</span>
            {
                //getBody().add(new Comment(&quot;Priority [&quot; + priority + &quot;] Values&quot;));
            }
<span class="fc" id="L461">            return priority;</span>
<span class="fc" id="L462">        }).forEachOrdered(priority -&gt;</span>
        {
<span class="fc" id="L464">            getPriorityRequirements(priority, requirements, false, true).stream().forEach(comp</span>
                    -&gt;
            {
<span class="fc" id="L467">                getBody().add(comp);</span>
<span class="fc" id="L468">            });</span>
<span class="fc" id="L469">        });</span>
<span class="fc" id="L470">    }</span>

    /**
     * Adds all the stuff for a given priority
     *
     * @param css        CSS
     * @param input      the hierarchy to read from
     * @param priority   the priority
     * @param javascript to return JavaScript or not
     */
    private List&lt;ComponentHierarchyBase&gt; getPriorityRequirements(RequirementsPriority priority, List&lt;ComponentHierarchyBase&gt; input, boolean css, boolean javascript)
    {
<span class="fc" id="L482">        List&lt;ComponentHierarchyBase&gt; requirements = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L483" title="All 2 branches covered.">        if (css)</span>
        {
<span class="pc bpc" id="L485" title="2 of 4 branches missed.">            getAllCssLinks(priority).stream().filter(cssLink -&gt; (!input.contains(cssLink) &amp;&amp; !requirements.contains(cssLink))).forEach(cssLink</span>
                    -&gt;
            {
<span class="fc" id="L488">                requirements.add(cssLink);</span>
<span class="fc" id="L489">            });</span>
        }
<span class="fc bfc" id="L491" title="All 2 branches covered.">        if (javascript)</span>
        {
<span class="pc bpc" id="L493" title="2 of 4 branches missed.">            getAllScripts(priority).stream().filter(script -&gt; (!input.contains(script) &amp;&amp; !requirements.contains(script))).forEach(script</span>
                    -&gt;
            {
<span class="fc" id="L496">                requirements.add(script);</span>
<span class="fc" id="L497">            });</span>
        }

<span class="fc" id="L500">        return requirements;</span>
    }

    /**
     * Gets all the links for all the bodies components
     *
     * @param priority
     *
     * @return
     */
    private List&lt;CSSLink&gt; getAllCssLinks(RequirementsPriority priority)
    {
<span class="fc" id="L512">        List&lt;CSSReference&gt; allReferences = getBody().getCssReferencesAll(priority);</span>
<span class="fc" id="L513">        allReferences.sort(WebReference.getDummyReference());</span>
<span class="fc" id="L514">        ArrayList&lt;CSSLink&gt; allLinks = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L515">        allReferences.stream().map(ref -&gt; new CSSLink(ref)).forEach(allLinks::add);</span>
<span class="fc" id="L516">        return allLinks;</span>
    }

    /**
     * Gets all the scripts for all the body components
     *
     * @param priority
     *
     * @return
     */
    private List&lt;Script&gt; getAllScripts(RequirementsPriority priority)
    {
<span class="fc" id="L528">        List&lt;JavascriptReference&gt; allJavascripts = getBody().getJavascriptReferencesAll(priority);</span>
<span class="fc" id="L529">        allJavascripts.sort(WebReference.getDummyReference());</span>
<span class="fc" id="L530">        ArrayList&lt;Script&gt; allScripts = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L531">        allJavascripts.stream().map(js -&gt; new Script(js)).forEach(s</span>
                -&gt;
        {
<span class="fc" id="L534">            s.setNewLineForClosingTag(false);</span>
<span class="fc" id="L535">            allScripts.add(s);</span>
<span class="fc" id="L536">        });</span>
<span class="fc" id="L537">        return allScripts;</span>
    }

    /**
     * Returns if the head object is empty
     *
     * @return
     */
    private boolean isHeadEmpty()
    {
<span class="fc" id="L547">        return getHead().getChildren().isEmpty();</span>
    }

    /**
     * Returns if the body object is empty
     *
     * @return
     */
    private boolean isBodyEmpty()
    {
<span class="fc" id="L557">        return getBody().getChildren().isEmpty();</span>
    }

    /**
     * Returns a readable user agent, or null if just a basic render
     *
     * @return
     */
    public ReadableUserAgent getUserAgent()
    {
<span class="nc bnc" id="L567" title="All 2 branches missed.">        if (userAgent == null)</span>
        {
<span class="nc" id="L569">            userAgent = new UserAgent(DeviceCategory.EMPTY, UserAgentFamily.FIREFOX, &quot;&quot;, &quot;&quot;, OperatingSystem.EMPTY, &quot;&quot;, &quot;&quot;, UserAgentType.BROWSER, &quot;&quot;, &quot;&quot;, VersionNumber.UNKNOWN);</span>
        }
<span class="nc" id="L571">        return userAgent;</span>
    }

    /**
     * Sets the userAgent
     *
     * @param userAgent
     */
    public void setUserAgent(ReadableUserAgent userAgent)
    {
<span class="nc" id="L581">        this.userAgent = userAgent;</span>
<span class="nc" id="L582">    }</span>

    /**
     * Returns all the dynamic options for a page
     *
     * @return
     */
    @Override
    public final PageOptions getOptions()
    {
<span class="fc bfc" id="L592" title="All 2 branches covered.">        if (options == null)</span>
        {
<span class="fc" id="L594">            options = new PageOptions(this);</span>
        }
<span class="fc" id="L596">        return options;</span>
    }

    /**
     * Returns the fields available for entry on this page
     *
     * @return
     */
    @Override
    public final PageFields getPageFields()
    {
<span class="fc bfc" id="L607" title="All 2 branches covered.">        if (fields == null)</span>
        {
<span class="fc" id="L609">            fields = new PageFields(this);</span>
        }
<span class="fc" id="L611">        return fields;</span>
    }

    /**
     * Returns the document type that will be rendered with this HTML page real-time
     * &lt;p&gt;
     * @return Document Type
     */
    @Override
    public DocumentType getDocumentType()
    {
<span class="nc" id="L622">        return new DocumentType(getBrowser().getHtmlVersion());</span>
    }

    /**
     * Sets all component in the head and body to tiny
     *
     * @param tiny
     *
     * @return
     */
    @Override
    public Page setTiny(boolean tiny)
    {
<span class="fc" id="L635">        super.setTiny(tiny);</span>
<span class="fc" id="L636">        getHead().setTiny(tiny);</span>
<span class="fc" id="L637">        getBody().setTiny(tiny);</span>
<span class="fc" id="L638">        return this;</span>
    }

    /**
     * Returns the JavaScript render for the body
     *
     * @return
     */
    @Override
    public StringBuilder renderJavascript()
    {
<span class="fc" id="L649">        return getBody().renderJavascript();</span>
    }

    /**
     * Adds a variable into angular
     *
     * @param variableName
     *
     * @return
     */
    @Override
    public Page addAngularVariable(String variableName)
    {
<span class="fc" id="L662">        getAngular().getAngularVariables().add(variableName);</span>
<span class="fc" id="L663">        return this;</span>
    }

    /**
     * Returns the angular object
     *
     * @return
     */
    @Override
    public AngularFeature getAngular()
    {
<span class="fc bfc" id="L674" title="All 2 branches covered.">        if (angular == null)</span>
        {
<span class="fc" id="L676">            angular = new AngularFeature(getBody());</span>
<span class="fc" id="L677">            getBody().addFeature(angular);</span>
        }
<span class="fc" id="L679">        return angular;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>